(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{527:function(t,n,a){"use strict";a.r(n);var s=a(4),e=Object(s.a)({},(function(){var t=this,n=t.$createElement,a=t._self._c||n;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"indexeddb-使用指南"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#indexeddb-使用指南"}},[t._v("#")]),t._v(" indexedDB 使用指南")]),t._v(" "),a("blockquote",[a("p",[t._v("记录了indexedDB的操作指南以及一些疑问")])]),t._v(" "),a("ul",[a("li",[a("p",[t._v("错误：版本更改事务正在进行 - 应该如何解决？")]),t._v(" "),a("blockquote",[a("h6",{attrs:{id:"错误代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#错误代码"}},[t._v("#")]),t._v(" 错误代码")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onSkuProduceConfigs")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("record"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("API")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("GetProductProduceItem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nhistory"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("/product/produce/sku/")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("record"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("id"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" DBControl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("open")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n dbName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DBName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addSkuToProduce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n tableName"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DBKey"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("addSkuToProduce"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n keyPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DBKeyPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("factoryId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("catch")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nDBControl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("DBKeyPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("factoryId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" DBKeyPath"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("factoryId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n factoryId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" record"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("factoryId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这种情况是在`onupgradeneeded`中通知了外部可以进行`readwrite`操作。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 但真正的情况是`onupgradeneeded` 事件虽然触发了，并不代表着`open`操作的结束。")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 能表示`open`操作的结束，是`onsuccess`函数")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br"),a("span",{staticClass:"line-number"},[t._v("14")]),a("br"),a("span",{staticClass:"line-number"},[t._v("15")]),a("br")])])])]),t._v(" "),a("li",[a("p",[t._v("自建索引如果设置"),a("code",[t._v("unique: true")]),t._v("该如何更新数据？")]),t._v(" "),a("ul",[a("li",[a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("objectStore"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("put")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("item"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" key"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 可以尝试下")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])])])])])]),t._v(" "),a("h3",{attrs:{id:"todo"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#todo"}},[t._v("#")]),t._v(" TODO")]),t._v(" "),a("ul",[a("li",[t._v("[ ] "),a("code",[t._v("localForage")]),t._v("indexedDB部分源码阅读\n"),a("ul",[a("li",[t._v("[ ] 尝试找出以上问题的解决方案")]),t._v(" "),a("li",[t._v("[x] "),a("code",[t._v("fn: _advanceReadiness")])]),t._v(" "),a("li",[t._v("[x] "),a("code",[t._v("fn:_binStringToArrayBuffer")])]),t._v(" "),a("li",[t._v("[x] "),a("code",[t._v("fn:_checkBlobSupport")])]),t._v(" "),a("li",[t._v("[x] "),a("code",[t._v("fn:_checkBlobSupportWithoutCaching")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:_decodeBlob")])]),t._v(" "),a("li",[t._v("[x] "),a("code",[t._v("fn:_deferReadiness")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:_encodeBlob")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:_fullyReady")])]),t._v(" "),a("li",[t._v("[x] "),a("code",[t._v("fn:_getConnection")])]),t._v(" "),a("li",[t._v("[x] "),a("code",[t._v("fn:_getOriginalConnection")])]),t._v(" "),a("li",[t._v("[x] "),a("code",[t._v("fn:_getUpgradedConnection")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:_initStorage")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:_isEncodedBlob")])]),t._v(" "),a("li",[t._v("[x] "),a("code",[t._v("fn:_isUpgradeNeeded")])]),t._v(" "),a("li",[t._v("[x] "),a("code",[t._v("fn:_rejectReadiness")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:_tryReconnect")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:clear")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:createDbContext")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:createTransaction")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:dropInstance")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:getItem")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:iterate")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:key")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:keys")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:length")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:removeItem")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("fn:setItem")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("var: asyncStorage")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("var: dbContexts")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("var: default")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("var: DETECT_BLOB_SUPPORT_STORE")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("var: READ_ONLY")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("var: READ_WRITE")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("var: supportsBlobs")])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("var: toString")])])])]),t._v(" "),a("li",[t._v("[ ] "),a("code",[t._v("ygIdb")]),t._v(" 封装\n"),a("ul",[a("li",[t._v("[x] 增删改查功能")]),t._v(" "),a("li",[t._v("[ ] 使用文档")]),t._v(" "),a("li",[t._v("[ ] 分享文章")])])]),t._v(" "),a("li",[t._v("[ ] DEMOS\n"),a("ul",[a("li",[t._v("[ ] SaaS监控存储demo")]),t._v(" "),a("li",[t._v("[ ] 照片打印存储demo")])])])])])}),[],!1,null,null,null);n.default=e.exports}}]);