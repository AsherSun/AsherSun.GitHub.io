(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{534:function(t,s,a){"use strict";a.r(s);var e=a(4),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("前情提要")]),t._v(" "),a("p",[t._v("在逛技术社区的过程中遇到这么一个问题：为什么获取"),a("code",[t._v("createRef")]),t._v("的结果需要多一层"),a("code",[t._v("current")]),t._v("呢？再回答完题主的问题后，便决定水一篇文章。"),a("br"),t._v("\n注：内容比较简单，如果喜欢点个赞，不喜勿喷。欢迎在评论区内交流。如果本人观点有错误的地方，恳请大佬多多指点，感谢🙏。\n再注：文中所有观点都是我个人理解，没有查阅"),a("code",[t._v("ECMAScript")]),t._v("官方文档。欢迎大佬在评论区内指点交流。")])]),t._v(" "),a("p",[t._v("先看下题主的问题：")]),t._v(" "),a("div",{staticClass:"language-tsx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 一直搞不明白这个API的设计，这里要多一层current是什么用意，")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 难道除了current外还有别的用法吗？")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果只有获取值的用法，为什么不直接简化成myRef1.value拿呢？")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" React"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("FC")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" myRef1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" React"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" onClick "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" React"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useCallback")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin"}},[t._v("console")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'myRef1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" myRef1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("value"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n    ")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("input")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ref")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("myRef1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("text"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("placeholder")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")]),t._v("点击提示createRef"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("'")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n    ")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("button")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("onClick")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("onClick"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("点击获取ref")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("button")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n  ")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br"),a("span",{staticClass:"line-number"},[t._v("10")]),a("br"),a("span",{staticClass:"line-number"},[t._v("11")]),a("br"),a("span",{staticClass:"line-number"},[t._v("12")]),a("br"),a("span",{staticClass:"line-number"},[t._v("13")]),a("br")])]),a("p",[t._v("题主的核心问题是为什么要多一层"),a("code",[t._v("current")]),t._v("？把"),a("code",[t._v("current")]),t._v("去掉，直接用"),a("code",[t._v("myRef1.value")]),t._v("不行吗？要想聊明白这个问题，就得聊聊"),a("code",[t._v("JavaScript")]),t._v("中的基本数据类型和引用数据类型。")]),t._v(" "),a("h2",{attrs:{id:"基本数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#基本数据类型"}},[t._v("#")]),t._v(" 基本数据类型")]),t._v(" "),a("p",[t._v("我们先定义一个变量，叫"),a("code",[t._v("baseType")])]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" baseType "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("后续的操作中，改变了变量"),a("code",[t._v("baseType")]),t._v("中的数据")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("baseType "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("那么这时候，变量"),a("code",[t._v("baseType")]),t._v("的内存指向是谁？指向的是内存中有"),a("code",[t._v("20")]),t._v("这个值的具体地址。如果不太理解的，我们可以根据JavaScript的执行步骤走一下：")]),t._v(" "),a("div",{staticClass:"custom-block theorem"},[a("p",{staticClass:"title"},[t._v("基本数据类型的内存指向")]),a("ul",[a("li",[t._v("当js执行到"),a("code",[t._v("baseType = 10")]),t._v("这行逻辑的时候，会在内存中开辟一个空间，空间中存储的值是10")]),t._v(" "),a("li",[t._v("这时候将内存空间的地址赋值给"),a("code",[t._v("baseType")]),t._v("变量")]),t._v(" "),a("li",[t._v("当前JS继续执行到"),a("code",[t._v("baseType = 20")]),t._v("这行逻辑的时候，也会在内存中开辟一个空间，空间中存储的值是20")]),t._v(" "),a("li",[t._v("然后再将20这个内存空间的地址赋值给"),a("code",[t._v("baseType")]),t._v("变量")])])]),a("p",[t._v("上述JavaScript的执行步骤可以理解吗？暂时还没有理解的没关系，给大佬上动图：\n")]),t._v(" "),a("h2",{attrs:{id:"引用数据类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引用数据类型"}},[t._v("#")]),t._v(" 引用数据类型")]),t._v(" "),a("p",[t._v("如果是引用数据类型呢？引用数据类型的地址是如何指向的？")]),t._v(" "),a("p",[t._v("首先，我们先定义一个变量，名称叫做"),a("code",[t._v("referencedType")]),t._v("，然后给它加一个字段")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" referencedType "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nreferencedType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'我是老A'")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br")])]),a("p",[t._v("后续操作中改变了变量"),a("code",[t._v("referencedType")]),t._v("中字段"),a("code",[t._v("a")]),t._v("的数据：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[t._v("referencedType"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("a "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'我发生了变异'")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br")])]),a("p",[t._v("执行完上述操作，并没有改变"),a("code",[t._v("referencedType")]),t._v("的内存指向。那么是改变了谁的内存指向呢？改变的是"),a("code",[t._v("referencedType")]),t._v("中字段"),a("code",[t._v("a")]),t._v("的内存指向。")]),t._v(" "),a("p",[t._v("所以，上述操作中，对于js来讲它的执行步骤是什么样子的？")]),t._v(" "),a("div",{staticClass:"custom-block theorem"},[a("p",{staticClass:"title"},[t._v("引用数据类型中字段值的改变")]),a("ul",[a("li",[t._v("当js执行到"),a("code",[t._v("referencedType = { }")]),t._v("这行逻辑的时候，会在内存中开辟一个空间，空间中存储的值是一个空对象"),a("code",[t._v("{}")])]),t._v(" "),a("li",[t._v("这时候将内存空间的地址赋值给"),a("code",[t._v("referencedType")]),t._v("变量")]),t._v(" "),a("li",[t._v("当前JS继续执行到"),a("code",[t._v("referencedType.a = '我是老A'")]),t._v("这行逻辑的时候，js发生了如下的操作\n"),a("ul",[a("li",[t._v("首先会开辟一个内存空间，空间中存储的值是"),a("code",[t._v("我是老A")])]),t._v(" "),a("li",[t._v("然后在"),a("code",[t._v("referencedType")]),t._v("变量上新增一个字段"),a("code",[t._v("a")]),t._v("并将"),a("code",[t._v("我是老A")]),t._v("这个内存地址赋值给字段"),a("code",[t._v("a")])]),t._v(" "),a("li",[t._v("这时候"),a("code",[t._v("referencedType")]),t._v("变量的具体值是："),a("code",[t._v("{a: '我是老A'}")])])])]),t._v(" "),a("li",[t._v("当前JS继续执行到"),a("code",[t._v("referencedType.a = '我发生了变异'")]),t._v("这行逻辑的时候，js发生了如下的操作\n"),a("ul",[a("li",[t._v("首先会开辟一个内存空间，空间中存储的值是"),a("code",[t._v("我发生了变异")])]),t._v(" "),a("li",[t._v("然后将"),a("code",[t._v("我发生了变异")]),t._v("这个内存地址重新赋值给"),a("code",[t._v("referencedType")]),t._v("变量上的字段"),a("code",[t._v("a")])]),t._v(" "),a("li",[t._v("这时候"),a("code",[t._v("referencedType")]),t._v("变量的具体值是："),a("code",[t._v("{a: '我发生了变异'}")])])])])])]),a("p",[t._v("上述JavaScript的执行步骤可以理解吗？暂时还没有理解的没关系，给大佬上动图：")]),t._v(" "),a("p",[t._v("这是引用数据类型中字段值的改变，如果我想直接改变"),a("code",[t._v("referencedType")]),t._v("这个引用数据类型的内存指向呢？")]),t._v(" "),a("p",[t._v("其实很简单，直接给变量"),a("code",[t._v("referencedType")]),t._v("重新赋值一个新的数据(可以是任意数据类型)。看代码：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//  重新赋值一个新的对象")]),t._v("\nreferencedType "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" six"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'我是老6'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 重新赋值一个字符串给变量 referencedType")]),t._v("\nreferencedType "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'我是变量referencedType'")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("那就有人说了，如果我不想修改变量"),a("code",[t._v("referencedType")]),t._v("的内存地址，也不想让其他人修改。这时候应该怎么办呢？")]),t._v(" "),a("p",[t._v("其实"),a("code",[t._v("ES6")]),t._v("已经给出了答案："),a("code",[t._v("const")]),t._v("。使用"),a("code",[t._v("const")]),t._v("声明一个常量，如果后续在代码中直接给"),a("code",[t._v("referencedType")]),t._v("赋值，是会抛错的。看代码：")]),t._v(" "),a("div",{staticClass:"language-javascript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" referencedType "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" a"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'我是老A'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 后续代码中想要修改referencedType的引用地址")]),t._v("\nreferencedType "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" six"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'我是老6'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// js执行到这一步的时候将抛错。")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br")])]),a("p",[t._v("如果有大佬想知道"),a("code",[t._v("const")]),t._v("、"),a("code",[t._v("let")]),t._v(" 、"),a("code",[t._v("var")]),t._v(" 这三个关键字声明变量的区别可以移步看下这篇文章："),a("a",{attrs:{href:"https://ashersun.github.io/js/%E4%BB%8E3%E4%B8%AAfor%E5%BE%AA%E7%8E%AF%E6%9D%A5%E7%90%86%E8%A7%A3JS%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("从三个for循环来理解js变量声明"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"createref为什么需要多一层current"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#createref为什么需要多一层current"}},[t._v("#")]),t._v(" createRef为什么需要多一层current")]),t._v(" "),a("p",[t._v("如果大佬们有理解上文所说的内容，那么看到这里其实就不用看了，所有的答案都在上文中。当然，在大佬们离开前卑微求一个赞")]),t._v(" "),a("p",[t._v("OK，回归正题。")]),t._v(" "),a("h3",{attrs:{id:"场景复现"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#场景复现"}},[t._v("#")]),t._v(" 场景复现")]),t._v(" "),a("p",[t._v("当我们给一个"),a("code",[t._v("DOM")]),t._v("节点绑定"),a("code",[t._v("ref")]),t._v("的时候，该语法是这样的:")]),t._v(" "),a("div",{staticClass:"language-tsx line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("TestRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ref "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" React"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("useRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("ref")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n     // 其他业务逻辑...\n    ")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" TestRef\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br"),a("span",{staticClass:"line-number"},[t._v("5")]),a("br"),a("span",{staticClass:"line-number"},[t._v("6")]),a("br"),a("span",{staticClass:"line-number"},[t._v("7")]),a("br"),a("span",{staticClass:"line-number"},[t._v("8")]),a("br"),a("span",{staticClass:"line-number"},[t._v("9")]),a("br")])]),a("p",[t._v("那么在"),a("code",[t._v("react")]),t._v("中，"),a("code",[t._v("ref")]),t._v("的绑定大致可以这样描述(只是伪代码，不可较真)：")]),t._v(" "),a("div",{staticClass:"language-JavaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ref "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("current"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("TestRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  ref"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("current "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("HTMLDivElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("如果"),a("code",[t._v("TestRef")]),t._v("这个组件内部有"),a("code",[t._v("useState")]),t._v("的操作，那么就会触发"),a("code",[t._v("render")]),t._v("函数的重新执行。可以这样理解：")]),t._v(" "),a("div",{staticClass:"language-JavaScript line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-javascript"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 触发了一次 useState操作，执行一次TesetRef方法")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("TestRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 又触发了一次 useState操作，又执行了一次TestRef方法")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("TestRef")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[t._v("1")]),a("br"),a("span",{staticClass:"line-number"},[t._v("2")]),a("br"),a("span",{staticClass:"line-number"},[t._v("3")]),a("br"),a("span",{staticClass:"line-number"},[t._v("4")]),a("br")])]),a("p",[t._v("根据上面的场景复现，我们可以这样理解：")]),t._v(" "),a("p",[t._v("每当"),a("code",[t._v("render")]),t._v("重新渲染，我们拿到的其实都是一个新的"),a("code",[t._v("DOM")]),t._v("对象，那么也就是一个新的内存地址。这就是为什么会多一层"),a("code",[t._v("current")]),t._v("的原因。如果没有这一层"),a("code",[t._v("current")]),t._v("，那么在"),a("code",[t._v("render")]),t._v("更新的时候就会导致"),a("code",[t._v("ref")]),t._v("绑定的丢失。")]),t._v(" "),a("h2",{attrs:{id:"结尾及勘误和说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结尾及勘误和说明"}},[t._v("#")]),t._v(" 结尾及勘误和说明")]),t._v(" "),a("p",[t._v("以上就是这篇文章的全部了，如果文章的内容有帮助到你，欢迎点赞、评论。如果有大佬发现文章内的一些错误，恳请大佬多多指点。在此多谢大佬🙇‍♀️。")]),t._v(" "),a("ul",[a("li",[t._v("在社区内发现的这个问答在这里："),a("a",{attrs:{href:"https://segmentfault.com/q/1010000041928218/a-1020000041933961",target:"_blank",rel:"noopener noreferrer"}},[t._v("飞机票✈️"),a("OutboundLink")],1)]),t._v(" "),a("li",[t._v("文章首发于个人博客："),a("a",{attrs:{href:"https://ashersun.github.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("飞机票✈️"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);