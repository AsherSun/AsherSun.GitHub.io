<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>《你不知道的JavaScript（上卷）》 | 十号</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="https://cdn.jsdelivr.net/gh/AsherSun/image-host/blog-img/xiuxian-logo.png">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.a883148b.css" as="style"><link rel="preload" href="/assets/js/app.730fe383.js" as="script"><link rel="preload" href="/assets/js/3.9989142c.js" as="script"><link rel="preload" href="/assets/js/1.3a008db8.js" as="script"><link rel="preload" href="/assets/js/42.a5250d52.js" as="script"><link rel="prefetch" href="/assets/js/10.3b912a2d.js"><link rel="prefetch" href="/assets/js/11.95014e5f.js"><link rel="prefetch" href="/assets/js/12.38f3c8e8.js"><link rel="prefetch" href="/assets/js/13.41755f38.js"><link rel="prefetch" href="/assets/js/14.e1655ac0.js"><link rel="prefetch" href="/assets/js/15.bce327d3.js"><link rel="prefetch" href="/assets/js/16.49b25e54.js"><link rel="prefetch" href="/assets/js/17.f1e266da.js"><link rel="prefetch" href="/assets/js/18.df83387c.js"><link rel="prefetch" href="/assets/js/19.30b3797f.js"><link rel="prefetch" href="/assets/js/20.2fdb598a.js"><link rel="prefetch" href="/assets/js/21.20fe2213.js"><link rel="prefetch" href="/assets/js/22.fde4fe00.js"><link rel="prefetch" href="/assets/js/23.29cb0f79.js"><link rel="prefetch" href="/assets/js/24.d53a8ebc.js"><link rel="prefetch" href="/assets/js/25.fc4aade1.js"><link rel="prefetch" href="/assets/js/26.a5747852.js"><link rel="prefetch" href="/assets/js/27.633e32cc.js"><link rel="prefetch" href="/assets/js/28.01f60ae7.js"><link rel="prefetch" href="/assets/js/29.b2c02be7.js"><link rel="prefetch" href="/assets/js/30.66607d96.js"><link rel="prefetch" href="/assets/js/31.fe42273d.js"><link rel="prefetch" href="/assets/js/32.6b9be322.js"><link rel="prefetch" href="/assets/js/33.4dbe597e.js"><link rel="prefetch" href="/assets/js/34.988e10fd.js"><link rel="prefetch" href="/assets/js/35.1fdb4c41.js"><link rel="prefetch" href="/assets/js/36.dc1941b7.js"><link rel="prefetch" href="/assets/js/37.bb0cb555.js"><link rel="prefetch" href="/assets/js/38.417a229f.js"><link rel="prefetch" href="/assets/js/39.d10940f4.js"><link rel="prefetch" href="/assets/js/4.500ff704.js"><link rel="prefetch" href="/assets/js/40.90cdab13.js"><link rel="prefetch" href="/assets/js/41.f5a89841.js"><link rel="prefetch" href="/assets/js/43.d2b53984.js"><link rel="prefetch" href="/assets/js/44.623633a1.js"><link rel="prefetch" href="/assets/js/45.a27fb66c.js"><link rel="prefetch" href="/assets/js/46.31453659.js"><link rel="prefetch" href="/assets/js/47.eddae06a.js"><link rel="prefetch" href="/assets/js/48.72596aa6.js"><link rel="prefetch" href="/assets/js/49.9f4d8f5b.js"><link rel="prefetch" href="/assets/js/5.47968762.js"><link rel="prefetch" href="/assets/js/50.63a79e0d.js"><link rel="prefetch" href="/assets/js/51.478b1b37.js"><link rel="prefetch" href="/assets/js/52.f006a0fc.js"><link rel="prefetch" href="/assets/js/53.f0ad8ec6.js"><link rel="prefetch" href="/assets/js/54.9b290e0b.js"><link rel="prefetch" href="/assets/js/55.1e86cfcc.js"><link rel="prefetch" href="/assets/js/56.da03d2fe.js"><link rel="prefetch" href="/assets/js/57.2c0018f9.js"><link rel="prefetch" href="/assets/js/58.0672aa51.js"><link rel="prefetch" href="/assets/js/59.b2e0a946.js"><link rel="prefetch" href="/assets/js/6.8b224979.js"><link rel="prefetch" href="/assets/js/60.f1f1fd89.js"><link rel="prefetch" href="/assets/js/61.20d6fc0f.js"><link rel="prefetch" href="/assets/js/62.31dadbfb.js"><link rel="prefetch" href="/assets/js/63.d2b3651e.js"><link rel="prefetch" href="/assets/js/64.89143d31.js"><link rel="prefetch" href="/assets/js/65.d85f1f89.js"><link rel="prefetch" href="/assets/js/66.976129a6.js"><link rel="prefetch" href="/assets/js/67.dca6b101.js"><link rel="prefetch" href="/assets/js/68.4aeeb689.js"><link rel="prefetch" href="/assets/js/69.58b5d893.js"><link rel="prefetch" href="/assets/js/7.2b74ab08.js"><link rel="prefetch" href="/assets/js/70.ab916a91.js"><link rel="prefetch" href="/assets/js/71.44b3dc4f.js"><link rel="prefetch" href="/assets/js/72.ce0608db.js"><link rel="prefetch" href="/assets/js/73.18528fe8.js"><link rel="prefetch" href="/assets/js/74.2b634d9d.js"><link rel="prefetch" href="/assets/js/75.0655e183.js"><link rel="prefetch" href="/assets/js/76.967caf97.js"><link rel="prefetch" href="/assets/js/77.7f8460af.js"><link rel="prefetch" href="/assets/js/78.24bd6824.js"><link rel="prefetch" href="/assets/js/79.dd7efbbf.js"><link rel="prefetch" href="/assets/js/8.65ce892c.js"><link rel="prefetch" href="/assets/js/80.8ecd58d1.js"><link rel="prefetch" href="/assets/js/81.e6963236.js"><link rel="prefetch" href="/assets/js/82.73ac9ee3.js"><link rel="prefetch" href="/assets/js/83.6714b1d0.js"><link rel="prefetch" href="/assets/js/84.c04671b9.js"><link rel="prefetch" href="/assets/js/85.a5064e46.js"><link rel="prefetch" href="/assets/js/86.8207ef25.js"><link rel="prefetch" href="/assets/js/87.8fda855c.js"><link rel="prefetch" href="/assets/js/88.e9f8592a.js"><link rel="prefetch" href="/assets/js/89.647bdc7b.js"><link rel="prefetch" href="/assets/js/9.b68cc135.js"><link rel="prefetch" href="/assets/js/90.97941095.js"><link rel="prefetch" href="/assets/js/91.0f4fde85.js"><link rel="prefetch" href="/assets/js/92.e8d1f6dc.js"><link rel="prefetch" href="/assets/js/93.2596127c.js"><link rel="prefetch" href="/assets/js/94.9bb9c945.js"><link rel="prefetch" href="/assets/js/95.abd0ee19.js"><link rel="prefetch" href="/assets/js/96.9efaa3e5.js"><link rel="prefetch" href="/assets/js/97.bbcd0e98.js"><link rel="prefetch" href="/assets/js/98.d74a45ef.js"><link rel="prefetch" href="/assets/js/99.46f91dc2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a883148b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-9f1e2f90><div data-v-9f1e2f90><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-9f1e2f90 data-v-9f1e2f90><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-58d5ab76 data-v-9f1e2f90 data-v-9f1e2f90><h3 class="title" style="display:none;" data-v-58d5ab76 data-v-58d5ab76>十号</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-58d5ab76 data-v-58d5ab76><input type="password" value="" data-v-58d5ab76> <span data-v-58d5ab76>Konck! Knock!</span> <button data-v-58d5ab76>OK</button></label> <div class="footer" style="display:none;" data-v-58d5ab76 data-v-58d5ab76><span data-v-58d5ab76><i class="iconfont reco-theme" data-v-58d5ab76></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-58d5ab76>vuePress-theme-reco</a></span> <span data-v-58d5ab76><i class="iconfont reco-copyright" data-v-58d5ab76></i> <a data-v-58d5ab76><span data-v-58d5ab76>十号</span>
            
          <!---->
          2022
        </a></span></div></div> <div class="hide" data-v-9f1e2f90><header class="navbar" data-v-9f1e2f90><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">十号</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont undefined"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/《小狗钱钱》/" class="nav-link"><i class="iconfont undefined"></i>
  《小狗钱钱》
</a></li><li class="dropdown-item"><!----> <a href="/categories/浏览器/" class="nav-link"><i class="iconfont undefined"></i>
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/categories/Docker/" class="nav-link"><i class="iconfont undefined"></i>
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/categories/note/" class="nav-link"><i class="iconfont undefined"></i>
  note
</a></li><li class="dropdown-item"><!----> <a href="/categories/微前端/" class="nav-link"><i class="iconfont undefined"></i>
  微前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/javascript/" class="nav-link"><i class="iconfont undefined"></i>
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/categories/React/" class="nav-link"><i class="iconfont undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/categories/工具/" class="nav-link"><i class="iconfont undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/categories/工具函数/" class="nav-link"><i class="iconfont undefined"></i>
  工具函数
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/about.html" class="nav-link"><i class="iconfont undefined"></i>
  简介
</a></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-9f1e2f90></div> <aside class="sidebar" data-v-9f1e2f90><div class="personal-info-wrapper" data-v-3eba7259 data-v-9f1e2f90><!----> <h3 class="name" data-v-3eba7259>
    十号
  </h3> <div class="num" data-v-3eba7259><div data-v-3eba7259><h3 data-v-3eba7259>20</h3> <h6 data-v-3eba7259>Article</h6></div> <div data-v-3eba7259><h3 data-v-3eba7259>19</h3> <h6 data-v-3eba7259>Tag</h6></div></div> <hr data-v-3eba7259></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont undefined"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/《小狗钱钱》/" class="nav-link"><i class="iconfont undefined"></i>
  《小狗钱钱》
</a></li><li class="dropdown-item"><!----> <a href="/categories/浏览器/" class="nav-link"><i class="iconfont undefined"></i>
  浏览器
</a></li><li class="dropdown-item"><!----> <a href="/categories/Docker/" class="nav-link"><i class="iconfont undefined"></i>
  Docker
</a></li><li class="dropdown-item"><!----> <a href="/categories/note/" class="nav-link"><i class="iconfont undefined"></i>
  note
</a></li><li class="dropdown-item"><!----> <a href="/categories/微前端/" class="nav-link"><i class="iconfont undefined"></i>
  微前端
</a></li><li class="dropdown-item"><!----> <a href="/categories/javascript/" class="nav-link"><i class="iconfont undefined"></i>
  javascript
</a></li><li class="dropdown-item"><!----> <a href="/categories/React/" class="nav-link"><i class="iconfont undefined"></i>
  React
</a></li><li class="dropdown-item"><!----> <a href="/categories/工具/" class="nav-link"><i class="iconfont undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/categories/工具函数/" class="nav-link"><i class="iconfont undefined"></i>
  工具函数
</a></li><li class="dropdown-item"><!----> <a href="/categories/vue/" class="nav-link"><i class="iconfont undefined"></i>
  vue
</a></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/about.html" class="nav-link"><i class="iconfont undefined"></i>
  简介
</a></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-58d5ab76 data-v-9f1e2f90><h3 class="title" style="display:none;" data-v-58d5ab76 data-v-58d5ab76>《你不知道的JavaScript（上卷）》</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-58d5ab76 data-v-58d5ab76><input type="password" value="" data-v-58d5ab76> <span data-v-58d5ab76>Konck! Knock!</span> <button data-v-58d5ab76>OK</button></label> <div class="footer" style="display:none;" data-v-58d5ab76 data-v-58d5ab76><span data-v-58d5ab76><i class="iconfont reco-theme" data-v-58d5ab76></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-58d5ab76>vuePress-theme-reco</a></span> <span data-v-58d5ab76><i class="iconfont reco-copyright" data-v-58d5ab76></i> <a data-v-58d5ab76><span data-v-58d5ab76>十号</span>
            
          <!---->
          2022
        </a></span></div></div> <div data-v-9f1e2f90><main class="page"><div class="page-title" style="display:none;"><h1 class="title">《你不知道的JavaScript（上卷）》</h1> <div data-v-42458482><i class="iconfont reco-account" data-v-42458482><span data-v-42458482>十号</span></i> <i class="iconfont reco-date" data-v-42458482><span data-v-42458482>2022-11-28</span></i> <!----> <i class="iconfont reco-tag tags" data-v-42458482><span class="tag-item" data-v-42458482>JavaScript</span><span class="tag-item" data-v-42458482>荒天帝</span></i></div></div> <div class="content__default"><div class="content__header"></div> <div class="content__default"><h2 id="第1章-作用域是什么"><a href="#第1章-作用域是什么" class="header-anchor">#</a> 第1章 作用域是什么？</h2> <div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>用来存储变量信息和变量值信息的一套运行规则。规则的定义是为了让程序能够存储、访问、修改变量和变量值信息。</p> <blockquote><p>几乎所有的编程语言最基本的功能之一，就是能够存储变量当中的值，并且能在之后对这个值进行访问或修改。事实上，正是这种存储和访问变量的值的能力将状态带给了程序。<br>
这些变量住在哪里？换句话说，它们存储在哪里？最重要的是，程序需要时如何找到它们？<br>
这些问题说明需要一套良好的规则来存储变量，并且之后可以方便的找到这些变量。这套规则被称为作用域。</p></blockquote></div><h3 id="_1-1-编译原理"><a href="#_1-1-编译原理" class="header-anchor">#</a> 1.1 编译原理</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>传统编译语言的流程为：</p> <ul><li>分词/词法分析(Tokenizing/Lexing)
<blockquote><p>这个过程会将由字符组成的字符串分解成（对编程语言来说）有意义的代码块，这些代码块被称为词法单元(token)。例如：考虑程序<code>var a = 2;</code>。这段程序通常会被分解成为下面这些词法单元：<code>var、a、=、2、;</code>。空格是否被当做词法单元，取决于空格在这门语言中是否具有意义。<br><br> <strong>分词（Tokenizing）和词法分析（Lexing）之间的区别是非常微妙、晦涩的，主要差异在于词法单元的识别是通过有状态还是无状态的方式进行的。</strong> 简单来说，如果词法单元生成器在判断a是一个独立的词法单元还是其他词法单元的一部分时，调用的是有状态的解析规则，那么这个过程就被称为词法分析。</p></blockquote></li> <li>解析/语法分析(Parsing)
<blockquote><p>这个过程是将词法单元流（数组）转换成由元素逐级嵌套所组成的代表了程序语法结构的树。这个树被称为“抽象语法树”（Abstract Syntax Tree，AST）。<br><br> <code>var = 2;</code>的抽象语法树中可能会有一个叫做VariableDeclaration的顶级节点，接下来是一个叫做Identifier（它的值是a）的子级节点，以及一个叫做AssignmentExpression的子节点。AssignmentExpression节点有一个叫做NumericLiteral（它的值是2）的子节点</p></blockquote></li> <li>代码生成
<blockquote><p>将AST转换为可执行的过程叫做代码生成。这个过程与语言、 目标平台等息息相关。<br><br>
抛开具体细节，简单来说就是有某种方法可以将<code>var a = 2;</code>的AST转化为一组机器指令，用来创建一个叫做a的变量（包括分配内存等），并将一个值存储在a中。<br><br> <strong>关于引擎如何管理系统资源超出了我们的讨论范围，因此只需要简单的了解引擎可以根据需要创建并存储变量即可。</strong></p></blockquote></li></ul></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>JavaScript的编译过程：</p> <blockquote><p>JavaScript的编译过程和传统编译语言非常相似</p></blockquote> <ul><li>JavaScript的编译过程不是发生在构建之前</li> <li>大部分情况下编译发生在代码执行前的几微秒（甚至更短！）的时间内。</li> <li>在词法分析和代码生成阶段有特定的步骤来对运行性能来进行优化，包括对冗余元素进行优化等。</li></ul></div><h3 id="_1-2-理解作用域"><a href="#_1-2-理解作用域" class="header-anchor">#</a> 1.2 理解作用域</h3> <h4 id="_1-2-1-演员表"><a href="#_1-2-1-演员表" class="header-anchor">#</a> 1.2.1 演员表</h4> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><ul><li>引擎
<blockquote><p>负责JavaScript程序的编译及执行过程</p></blockquote></li> <li>编译器
<blockquote><p>负责语法分析及代码生成</p></blockquote></li> <li>作用域
<blockquote><p>负责收集并维护由所有声明的标识符（变量）组成的一系列查询，并实施一套非常严格的规则，确定当前执行的代码对这些标识符的访问权限</p></blockquote></li></ul></div><h4 id="_1-2-2-引擎的执行过程"><a href="#_1-2-2-引擎的执行过程" class="header-anchor">#</a> 1.2.2 引擎的执行过程</h4> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p><code>var a = 2;</code>这段程序时，编译器的处理步骤：</p> <ol><li>首先编译器将这段程序分解成词法单元，然后将词法单元解析成一个树结构。</li> <li>遇到var a,编译器询问作用域是否存在同名称a的变量。</li></ol> <blockquote><ul><li>如果存在，则忽略该声明</li> <li>如果不存在，作用域会在当前的作用域集合中声明一个新的变量，并命名为a</li></ul></blockquote> <ol start="3"><li>编译器为引擎生成运行时所需的代码，用于处理<code>a = 2</code>这个赋值操作</li> <li>引擎运行时会询问作用域，在当前的作用域中是否存在一个叫做a的变量。</li></ol> <blockquote><ul><li>如果存在，引擎会使用这个变量</li> <li>如果不存在，引擎会继续查找该变量</li></ul></blockquote> <ol start="4"><li>最终引擎找到了a变量，就会将2赋值给它。如果没有找到，则会抛错。</li></ol></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>总结：变量的赋值操作会执行两个动作</p> <ol><li>编译器会在当前作用域中声明一个变量（如果之前没有声明过）</li> <li>在运行时，引擎会在作用域中查找该变量，如果能找到就会进行赋值操作。</li></ol></div><h4 id="_1-2-3-引擎的查找方式"><a href="#_1-2-3-引擎的查找方式" class="header-anchor">#</a> 1.2.3 引擎的查找方式</h4> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>引擎查找变量的过程由作用域进行协助，但引擎执行怎样的查找，会影响最终的查找结果。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>引擎的查找类型有两种：</p> <ul><li>LHS（左查询）</li> <li>RHS（右引用或者右查询）</li></ul></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>RHS（右引用）查询与简单的查找某个变量的值别无二致，而LHS（左）查询是试图找到变量的容器本身，从而可以对其赋值。从这个角度说，RHS（右引用）并不是真正意义上的“赋值操作的右侧”，更准确的说是非左侧。</p></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>下列代码中存在哪些LHS（左查询）和RHS（右引用）？</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><code>a = 2</code> 是LHS（左查询）操作</li> <li><code>console</code> 是RHS（右引用）操作</li> <li><code>(a)</code> 是RHS（右引用）操作</li></ul></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>下列代码中存在哪些LHS（左查询）和RHS（右引用）</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>LHS（左查询）操作：</p> <ul><li><code>foo</code>方法的形参<code>a = 2</code>的操作
RHS（右引用查询）操作：</li> <li>查找<code>foo</code>方法</li> <li>查找<code>console</code>对象</li> <li>查找<code>console.log(a)</code>中的变量<code>a</code>的值</li></ul></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>你可能会倾向于将函数声明<code>function foo(a) {...}</code>概念化为普通的变量申明和赋值，比如<code>var foo</code>、<code>foo = function(a) {...}</code>。如果这样理解的话，这个函数声明将需要进行LHS（左）查询。<br><br>
然而还有一个重要的细微差别，编译器可以在代码生成的同时处理声明和值的定义，比如在引擎执行代码时，并不会有线程专门用来将一个函数值“分配给”foo。因此，将函数声明理解成前面讨论的LHS（左）查询和赋值的形式并不合适。</p></div><h4 id="_1-2-5-小测验"><a href="#_1-2-5-小测验" class="header-anchor">#</a> 1.2.5 小测验</h4> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>找出下面代码中的LHS（左查询）和RHS（右引用查询）</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> b <span class="token operator">=</span> a<span class="token punctuation">;</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>LHS查询</p> <ul><li><code>c = foo(2)</code>是LHS查询</li> <li>foo函数的形参<code>a = 2</code>是LHS查询</li> <li><code>b = a</code>是LHS查询</li></ul> <p>RHS 查询</p> <ul><li><code>foo(2)</code>方法调用是RHS查询</li> <li><code>= a</code> 是RHS查询</li> <li><code>a + b</code> 是两处RHS查询</li></ul></div><h3 id="_1-3-作用域嵌套"><a href="#_1-3-作用域嵌套" class="header-anchor">#</a> 1.3 作用域嵌套</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>当一个块或函数嵌套在另一个块或函数中时，就发生了作用域嵌套。<br>
当前作用域中无法找到某个变量时，引擎就会在外层嵌套的作用域中继续查找，直到找到该变量或抵达最外层作用域（全局作用域）。<br>
当抵达最外层的全局作用域时，无论找到还是没找到，查找过程都会停止。<br></p></div><h3 id="_1-4-异常"><a href="#_1-4-异常" class="header-anchor">#</a> 1.4 异常</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>如果RHS（右引用）查询在所有嵌套的作用域中遍寻不到所需的变量，引擎就会抛出ReferenceError异常。ReferenceError异常是非常重要的异常。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>如果是LHS（左）查询时，在所有嵌套的作用域中遍寻不到所需要的变量时（包括顶层的全局作用域），那么全局作用域中就会创建一个具有该名称的变量，并返回给引擎。这一切的前提是程序运行在非“严格模式”下。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>严格模式禁止自动或隐式地创建全局变量。因此，在严格模式中LHS（左）查询失败时，引擎会抛出ReferenceError异常。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>在RHS查询到了一个变量，但是对这个变量的值进行不合理的操作，比如对一个非函数类型的值进行函数调用，或者引用null或undefined类型的值的属性。引擎会抛TypeError异常。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p><strong>ReferenceError同作用域判别失败相关，而TypeError则代表作用域判别成功了，但是对结果的操作是非法或者不合理的。</strong></p></div><h3 id="_1-5-小结"><a href="#_1-5-小结" class="header-anchor">#</a> 1.5 小结</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>作用域是一套规则，用于确定在何处以及如何查找变量（标识符）。如果查找的目的是对变量进行赋值，那么就会使用LHS查询；如果目的是获取变量的值，就会使用RHS查询。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>LHS和RHS都会在当前执行的作用域中开始，如果在当前执行的作用域中没有找到，那么就会向上级作用域中继续查找，最后抵达全局作用域，无论是否找到都将会停止查询操作。</p></div><h2 id="第2章-词法作用域"><a href="#第2章-词法作用域" class="header-anchor">#</a> 第2章 词法作用域</h2> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>作用域有两种主要的工作模型。第一种是词法作用域，最为普通且被大多数编程语言所采用的（词法作用域）。另一种是动态作用域，比如：Bash脚本、Perl中的一些模式等。<br> <strong>JavaScript所采用的是词法作用域。</strong></p></div><h3 id="_2-1-词法阶段"><a href="#_2-1-词法阶段" class="header-anchor">#</a> 2.1 词法阶段</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>词法作用域是由你在写代码时将变量和块作用域写在哪里决定的，因此当词法分析器处理代码时会保持作用域不变（大部分情况下是这样的）。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>每个函数都会创建一个新的作用域</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>作用域查找会在找到第一个匹配的标识符时停止。在多层的嵌套作用域中可以定义同名的标识符，这叫“遮蔽效应”（内部的标识符“遮蔽”了外部的标识符）。抛开遮蔽效应，作用域查找始终从运行时所处的最内部作用域开始，逐级向外或者说向上进行，知道遇见第一个匹配的标识符为止。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>全局变量会自动的成为全局对象（比如浏览器的window对象）的属性。因此可以不直接通过全局对象的词法名称，而是间接的通过对全局对象属性的引用来进行访问。比如<code>window.a</code>。这种方式可以访问那些被同名变量所遮蔽的全局变量。但非全局的变量如果被遮蔽了，无论如何都无法访问到。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>词法作用域查找只会查找一级标识符，比如<code>a、b</code>和<code>c</code>。如果代码中引用了<code>foo.bar.baz</code>，词法作用域查找只会试图查找foo标识符，找到这个变量后，对象属性访问规则会分别接管对<code>bar</code>和<code>baz</code>属性的访问。</p></div><h3 id="_2-2-词法欺骗"><a href="#_2-2-词法欺骗" class="header-anchor">#</a> 2.2 词法欺骗</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>欺骗词法作用域会导致性能下降。</p></div><h4 id="_2-2-1-动态运行时"><a href="#_2-2-1-动态运行时" class="header-anchor">#</a> 2.2.1 动态运行时</h4> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>在执行<code>eval(...)</code>之后的代码时，引擎并不“知道”或者“在意”前面的代码是以动态形式插入进来，并对词法作用域的环境进行修改的。引擎只会如往常地进行词法作用域查找。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>一下代码：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">str<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">eval</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token string">'var b = 3;'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这段代码实际上在foo(...)内部创建了一个变量b，并遮蔽了外部（全局）作用域中的同名变量。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>默认情况下，如果eval(...)中所执行的代码包含至少有一个或多个声明（无论是变量还是函数），就会对eval(...)所处的词法作用域进行修改。通过一些技巧可以间接调用eval(...)来使其运行在全局作用域中，并对全局作用域进行修改。但无论何种情况，evel(...)都可以在运行期间修改书写期的词法作用域。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>在严格模式的程序中，eval(...)在运行时尤其自己的词法作用域，意味着其中的声明无法修改所在的作用域。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>
  <span class="token function">eval</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError: a is not define</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token string">'var a = 2;'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>setTimeout(...)和setInterval(...)的第一个参数可以是字符串，字符串的内容可以被解释为一段动态生成的函数代码。这些功能已经过时并且不被提倡。不要使用它们！</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>new Function(...)函数的行为也很类似，最后一个参数可以接受代码字符串，并将其转化为动态生成的函数（前面的参数是这个新生成函数的形参）。这种构建函数的语法比eval(...)略微安全一些。但也要尽量避免使用。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>在程序中动态生成代码的使用场景非常罕见，因为它所带来的好处无法低效性能上的损失。</p></div><h4 id="_2-2-2-with"><a href="#_2-2-2-with" class="header-anchor">#</a> 2.2.2 with</h4> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>with可以将一个没有或有多个属性的对象处理为一个完全隔离的词法作用域，因此这个对象的属性也会被处理为定义在这个作用域中的词法标识符。</p></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>所以，在es6中的块级作用域中也会失效吗? 比如，用es6的引擎执行下列代码</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">1</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">with</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    b <span class="token operator">=</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>b<span class="token punctuation">)</span> <span class="token comment">// undefined</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'foo-'</span><span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>答案是不会报错，在全局作用域中确实存在变量b</p> <blockquote><p>尽管with块可以将一个对象处理为词法作用域，但是这个块内部正常的var声明并不会被限制在这个块的作用域中，而是被添加到with所处的函数作用域中。</p></blockquote></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>eval(...)函数如果接受了含有一个或多个声明的代码，就会修改其所处的词法作用域，而with声明实际上是根据你传递给它的对象凭空创建了一个全新的词法作用域。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>不推荐使用eval(...)和with的原因是会被严格模式所影响（限制）。with被完全禁止，而在保留核心功能的前提下，间接或非安全的使用eval(...)也被禁止了。</p></div><h4 id="_2-2-3-性能"><a href="#_2-2-3-性能" class="header-anchor">#</a> 2.2.3 性能</h4> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>使用动态运行时（eval、new Function、setTimeout等）和with会影响JavaScript的性能。因为JavaScript引擎会在编译阶段进行数项的性能优化。其中有些优化依赖于能够根据代码的词法进行分析，并预先确定所有变量和函数的定义位置，才能在执行过程中快速找到标识符。
动态运行时和with的副作用是引擎无法在编译时对作用域查找进行优化，因为引擎只能谨慎地认为这样的优化是无效的。使用其中任何一个机制都将导致代码运行变慢。</p></div><h2 id="第3章-函数作用域和块作用域"><a href="#第3章-函数作用域和块作用域" class="header-anchor">#</a> 第3章 函数作用域和块作用域</h2> <h3 id="_3-1-函数中的作用域"><a href="#_3-1-函数中的作用域" class="header-anchor">#</a> 3.1 函数中的作用域</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>JavaScript具有基于函数的作用域，意味着每创建一个函数都会有一个作用域</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>函数内部创建的变量无法被外部访问，也就是说这些变量无法在全局作用域中访问</p></div><h3 id="_3-2-隐藏内部实现"><a href="#_3-2-隐藏内部实现" class="header-anchor">#</a> 3.2 隐藏内部实现</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>在函数中创建的变量都将绑定在这个新创建的函数作用域中，而不是在函数之外的作用域中</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>最小特权原则<br></p> <blockquote><p>这个原则是指在软件设计中，应该最小限度地暴露必要内容，而将其他内容都“隐藏”起来，比如某个模块或对象的API设计。
如果所有的变量或函数都在全局作用域中，会破坏最小特权原则。</p></blockquote></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>规避冲突<br>
将变量或函数放在函数作用域中，可以避免同名标识符的冲突。
例如：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    i <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// 修改for循环所属作用域中的i</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">bar</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// 无限循环了</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>全局命名空间<br>
如果不妥善的处理某一个库中的私有方法，极容易导致和第三方库的方法冲突。所以，这些库通常只会声明一个足够独特的名称，通常是一个对象的名称。所需要暴露给外界的功能都将成为这个对象下的属性方法。
例如：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> MyReallyCoolLibrary <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">noSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>模块管理<br>
模块管理的工具是利用作用域的规则强制所有标识符都不能注入到共享作用域中，而是保持在私有、无冲突的作用域中，这样可以有效规避掉所有的意外冲突。</p></div><h3 id="_3-3-函数作用域"><a href="#_3-3-函数作用域" class="header-anchor">#</a> 3.3 函数作用域</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>区分函数声明和表达式最简单的方法是看function关键字出现在声明的位置（不仅仅是一行代码，而是整个声明的位置）。如果function是声明中的第一个词，那么就是一个函数声明，否则就是一个函数表达式。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p><code>(function foo(){...})</code>作为函数表达式意味着foo只能在<code>...</code>所代表的位置中被访问，外部作用域不行。foo变量名称被影藏在自身中意味着不会非必要的污染外部作用域。</p></div><h4 id="_3-3-1-匿名和具名"><a href="#_3-3-1-匿名和具名" class="header-anchor">#</a> 3.3.1 匿名和具名</h4> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>以下代码示例：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'...'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这叫匿名函数表达式，因为<code>function()...</code>没有标识符。函数表达式可以是匿名的，而函数声明则不可以省略函数名 ———— 在JavaScript的语法中这是非法的。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>匿名函数的几个缺点：</p> <ol><li>匿名函数在栈追踪中不会显示出有意义的函数名，这使得调试困难。</li> <li>如果没有函数名，当函数需要引用自身时只能使用已过期的arguments.callee引用，比如递归中。另一个函数需要引用自身的例子，是在事件触发后事件监听器需要解绑自身。</li> <li>匿名函数省略了对代码可读性/可理解性很重要的函数名。一个描述性的名称可以让代码不言自明。</li></ol></div><h4 id="_3-3-2-立即执行函数表达式"><a href="#_3-3-2-立即执行函数表达式" class="header-anchor">#</a> 3.3.2 立即执行函数表达式</h4> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>第一个<code>()</code>将函数变成表达式，第二个<code>()</code>执行了这个函数。<br>
这种模式有一个术语：IIFE，代表立即执行函数表达式（IIFE，代表立即执行函数表达式（Immediately Invoked Function Expression）</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>IIFE的另一种改进形式： <code>(function(){}())</code>。这种形式与常见的IIFE形式的功能上是一致的。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>IIFE另一种进阶用法是把它们当做函数调用并传递参数进去。
例如：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">global</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>global<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这种方式解决的另一个应用场景是解决undefined标识符的默认值被错误覆盖导致的异常。例如：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">undefined</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token keyword">undefined</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> a<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>a <span class="token operator">===</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>IIFE的另一种用途是倒置代码运行顺序，将需要运行的函数放在第二位，在IIFE执行之后当做参数传递进去。这种模式在UMD（Universal Module Definition）项目中被广泛使用。
例如：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">def</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">def</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">def</span><span class="token punctuation">(</span><span class="token parameter">global</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>global<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div><h3 id="_3-4-块作用域"><a href="#_3-4-块作用域" class="header-anchor">#</a> 3.4 块作用域</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>ES6标准之前不存在块作用域概念，ES6的标准中新增了块作用域的概念。</p></div><h4 id="_3-4-2-try-catch"><a href="#_3-4-2-try-catch" class="header-anchor">#</a> 3.4.2 try/catch</h4> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>在ES3规范中，try/catch的catch分句会创建一个块作用域，其中声明的变量仅在catch内部有效。
例如：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token keyword">undefined</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 执行一个非法操作来触发异常</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 能够正常执行</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div><h4 id="_3-4-3-let"><a href="#_3-4-3-let" class="header-anchor">#</a> 3.4.3 let</h4> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>let关键字可以将变量绑定到所在的任意作用域中（通常是{ .. }内部）</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>foo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> bar <span class="token operator">=</span> foo <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span> <span class="token comment">// ReferenceError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>使用let进行的声明不会在块作用域中提升，声明之前去使用，变量并不“存在”。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
  <span class="token keyword">let</span> bar <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></div><h4 id="_3-4-3-垃圾收集"><a href="#_3-4-3-垃圾收集" class="header-anchor">#</a> 3.4.3 垃圾收集</h4> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 做点事情</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> someReallyBigData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">process</span><span class="token punctuation">(</span>someReallyBigData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;my button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>click函数的点击回调并不需要someReallyBigData变量。理论上这意味着当process(..)执行后，在内存中占用大量空间的数据结构就可以被垃圾回收了。但是，由于click函数形成了一个覆盖整个作用域的闭包，JavaScript引擎极有可能依然保存着这个结构（取决于具体实现）。<br></p> <p>块作用域可以打消这种顾虑，可以让引擎清楚地知道没有必要继续保存someReallyBigData了：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 做点事情</span>
<span class="token punctuation">}</span>
<span class="token punctuation">{</span>
  <span class="token keyword">var</span> someReallyBigData <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token function">process</span><span class="token punctuation">(</span>someReallyBigData<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> btn <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">&quot;my button&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
btn<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'click button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div><h4 id="_3-3-4-const"><a href="#_3-3-4-const" class="header-anchor">#</a> 3.3.4 const</h4> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>const 同样可以创建块作用域，但其值是固定的（常量）。</p></div><h2 id="第4章-变量提升和函数提升"><a href="#第4章-变量提升和函数提升" class="header-anchor">#</a> 第4章 变量提升和函数提升</h2> <h3 id="_4-1-先有鸡还是先有蛋"><a href="#_4-1-先有鸡还是先有蛋" class="header-anchor">#</a> 4.1 先有鸡还是先有蛋</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>以下代码会输出什么？</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a<span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>会输出2</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>以下代码会输出什么？</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>输出undefined</p></div><h3 id="_4-2-编译器再度来袭"><a href="#_4-2-编译器再度来袭" class="header-anchor">#</a> 4.2 编译器再度来袭</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>编译阶段中的一部分工作就是找到所有的声明，并用合适的作用域将它们关联起来。也正是词法作用域的核心内容。</p> <p>正确的思考思路是，包括变量和函数在内的所有声明都会在任何代码被执行前首先被处理。</p> <p>这个<code>var a = 2;console.log(a);</code>代码片段会以如下方式执行：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> a<span class="token punctuation">;</span> <span class="token comment">// 定义声明，在编译阶段进行</span>
a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// 赋值声明会留在执行阶段</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>这个过程就叫作（变量）提升。换句话说，先有蛋（声明）后有鸡（赋值）。</p></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>只有声明本身会被提升，而赋值或其他运行逻辑会留在原地。如果提升改变了代码执行的顺序，会造成非常严重的破坏。</p> <p>另外值得注意的是，每个作用域都会进行提升操作。例如下列代码：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>可以看到上面的代码片段，函数声明会被提升，但是函数表达式却不会被提升。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 不是ReferenceError，而是TypeError</span>

<span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这段程序中的变量标识符foo()被提升并分配给所在作用域（在这里是全局作用域），因此foo()不会导致ReferenceError。但是foo此时并没有赋值（如果它是一个函数声明而不是函数表达式，那么就会赋值）。foo()由于对undefined值进行函数调用而导致非法操作，因此抛出TypeError异常。</p> <p>即使是具名的函数表达式，名称标识符在赋值之前也无法在所在作用域中使用：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError</span>

<span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>这段代码经过提升后，实际上会被理解为以下形式：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> foo<span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>

<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token operator">...</span>self<span class="token operator">...</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></div><h3 id="_4-3-函数优先"><a href="#_4-3-函数优先" class="header-anchor">#</a> 4.3 函数优先</h3> <p>函数声明和变量声明都会被提升。但是一个值得注意的细节（这个细节可以出现在有多个“重复”声明的代码中）是函数会首先被提升，然后才是变量。</p> <p>比如这个代码片段：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token keyword">var</span> foo<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>会输出1而不是2！这个代码片段会被引擎理解为如下形式：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1</span>

<span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>var foo尽管出现在function foo()..．的声明之前，但它是重复的声明（因此被忽略了），因为函数声明会被提升到普通变量之前。</p> <p>尽管重复的var声明会被忽略掉，但出现在后面的函数声明还是可以覆盖前面的。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>一个普通块内部的函数声明通常会被提升到所在作用域的顶部，这个过程不会像下面的代码暗示的那样可以被条件判断所控制：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;b&quot;</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>但是需要注意这个行为并不可靠，在JavaScript未来的版本中有可能发生改变，因此应该尽可能避免在块内部声明函数。</p> <h2 id="第5章-作用域闭包"><a href="#第5章-作用域闭包" class="header-anchor">#</a> 第5章 作用域闭包</h2> <h3 id="_5-1-启示"><a href="#_5-1-启示" class="header-anchor">#</a> 5.1 启示</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>闭包是基于词法作用域书写代码时所产生的自然结果，你甚至不需要为了利用它们而有意识地创建闭包。闭包的创建和使用在你的代码中随处可见。</p></div><h3 id="_5-2-实质问题"><a href="#_5-2-实质问题" class="header-anchor">#</a> 5.2 实质问题</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使函数是在当前词法作用域之外执行。</p> <p>例如这段代码：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
  <span class="token punctuation">}</span>

  <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>这是闭包吗？</p> <p>技术上来讲，也许是。但根据前面的定义，确切地说并不是。我认为最准确地用来解释bar()对a的引用的方法是词法作用域的查找规则，而这些规则只是闭包的一部分。（但却是非常重要的一部分！）</p> <p>在上面的代码片段中，函数bar()具有一个涵盖foo()作用域的闭包（事实上，涵盖了它能访问的所有作用域，比如全局作用域）。也可以认为bar()封闭了foo()的作用域中。为什么呢？原因简单明了，因为bar()嵌套在foo()内部。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>这一段代码清晰的展示了闭包:</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> bar<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> baz <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2——朋友，这就是闭包的效果。</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在这个例子中，它在自己定义的词法作用域以外的地方执行。</p> <p>在foo()执行后，通常会期待foo()的整个内部作用域都被销毁，因为我们知道引擎有垃圾回收器用来释放不再使用的内存空间。由于看上去foo()的内容不会再被使用，所以很自然地会考虑对其进行回收。</p> <p>闭包可以阻止这件事情的发生。事实上内部作用域依然存在，因此没有被回收。因为bar()本身在使用它。</p> <p>bar()依然持有对该作用域的引用，而这个引用就叫作闭包。</p> <p>当然，无论使用何种方式对函数类型的值进行传递，当函数在别处被调用时都可以观察到闭包。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
  <span class="token punctuation">}</span>

  <span class="token function">bar</span><span class="token punctuation">(</span>baz<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 妈妈快看呀，这就是闭包！</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>把内部函数baz传递给bar，当调用这个内部函数时（现在叫作fn），它涵盖的foo()内部作用域的闭包就可以观察到了，因为它能够访问a。</p> <p>传递函数当然也可以是间接的。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> fn<span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  fn <span class="token operator">=</span> baz<span class="token punctuation">;</span> <span class="token comment">// 将baz分配给全局变量</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 妈妈快看呀，这就是闭包！</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>无论通过何种手段将内部函数传递到所在的词法作用域以外，它都会持有对原始定义作用域的引用，无论在何处执行这个函数都会使用闭包。</p></div><h3 id="_5-4-循环和闭包"><a href="#_5-4-循环和闭包" class="header-anchor">#</a> 5.4 循环和闭包</h3> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> i <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>正常情况下，我们对这段代码行为的预期是分别输出数字1～5，每秒一次，每次一个。但实际上，这段代码在运行时会以每秒一次的频率输出五次6。</p> <p>这个循环的终止条件是不再&lt;=5。条件成立时i的值是6。因此，输出显示的是循环结束时的最终值。</p> <p>根据作用域的工作原理，实际情况是尽管循环中的五个函数是在各个迭代中分别定义的，但是它们都被封闭在一个共享的全局作用域中，因此实际上只有一个i。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> i＊<span class="token number">1000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>这种方式也是不行的，因为还是共享同一个作用域中的变量i。</p> <p>我们需要在每个函数作用域中去缓存下当前的for循环的的变量i。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">j</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> j＊<span class="token number">1000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在迭代内使用IIFE会为每个迭代都生成一个新的作用域，使得延迟函数的回调可以将新的作用域封闭在每个迭代内部，每个迭代中都会含有一个具有正确值的变量供我们访问。</p> <h4 id="重返块作用域"><a href="#重返块作用域" class="header-anchor">#</a> 重返块作用域</h4> <p>let可以用来劫持块作用域，并且在这个块作用域中声明一个变量。</p> <p>因此，下面这些代码就可以正常运行了：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> <span class="token comment">// 是的，闭包的块作用域！</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> j＊<span class="token number">1000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>for循环头部的let声明还会有一个特殊的行为。这个行为指出变量在循环过程中不止被声明一次，每次迭代都会声明。随后的每个迭代都会使用上一个迭代结束时的值来初始化这个变量。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">&lt;=</span><span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">timer</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> i＊<span class="token number">1000</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_5-5-模块"><a href="#_5-5-模块" class="header-anchor">#</a> 5.5 模块</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">CoolModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> something <span class="token operator">=</span> <span class="token string">&quot;cool&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> another <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>something<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">doAnother</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>another<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">&quot; ! &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        doSomething<span class="token punctuation">:</span> doSomething<span class="token punctuation">,</span>
        doAnother<span class="token punctuation">:</span> doAnother
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> foo <span class="token operator">=</span> <span class="token function">CoolModule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

foo<span class="token punctuation">.</span><span class="token function">doSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// cool</span>
foo<span class="token punctuation">.</span><span class="token function">doAnother</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 1 ! 2 ! 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>这个模式在JavaScript中被称为模块。最常见的实现模块模式的方法通常被称为模块暴露，这里展示的是其变体。</p> <p>从模块中返回一个实际的对象并不是必须的，也可以直接返回一个内部函数。jQuery就是一个很好的例子。jQuery和$标识符就是jQuery模块的公共API，但它们本身都是函数（由于函数也是对象，它们本身也可以拥有属性）。</p></div><h2 id="附录a-动态作用域"><a href="#附录a-动态作用域" class="header-anchor">#</a> 附录A 动态作用域</h2> <p>事实上JavaScript并不具有动态作用域。它只有词法作用域，简单明了。但是this机制某种程度上很像动态作用域。</p> <p>主要区别：词法作用域是在写代码或者说定义时确定的，而动态作用域是在运行时确定的。（this也是！）词法作用域关注函数在何处声明，而动态作用域关注函数从何处调用。</p> <p>最后，this关注函数如何调用，这就表明了this机制和动态作用域之间的关系多么紧密。如果想了解更多关于this的详细内容，参见本书第二部分“this和对象原型”。</p> <h2 id="附录b-块作用域的替代方案"><a href="#附录b-块作用域的替代方案" class="header-anchor">#</a> 附录B 块作用域的替代方案</h2> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>上面的代码在ES6之前的环境中如何才能实现这个效果？</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">try</span><span class="token punctuation">{</span><span class="token keyword">throw</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>我们看见一个会强制抛出错误的try/catch，但是它抛出的错误就是一个值2，然后catch分句中的变量声明会接收到这个值。</p> <p>没错，catch分句具有块作用域，因此它可以在ES6之前的环境中作为块作用域的替代方案。</p> <h3 id="traceur"><a href="#traceur" class="header-anchor">#</a> Traceur</h3> <p>Google维护着一个名为Traceur的项目，该项目正是用来将ES6代码转换成兼容ES6之前的环境（大部分是ES5，但不是全部）。TC39委员会依赖这个工具（也有其他工具）来测试他们指定的语义化相关的功能。</p> <h3 id="隐式和显式作用域"><a href="#隐式和显式作用域" class="header-anchor">#</a> 隐式和显式作用域</h3> <div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>let作用域或let申明</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">let</span> <span class="token punctuation">(</span>a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>let声明有意将变量声明放在块的顶部，如果你并没有到处使用let定义，那么你的块作用域就很容易辨识和维护。</p> <p>但是这里有一个小问题，let声明并不包含在ES6中。官方的Traceur编译器也不接受这种形式的代码。</p> <p>我们有两个选择，使用合法的ES6语法并且在代码规范性上做一些妥协。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token regex">/＊let＊/</span> 
<span class="token punctuation">{</span> <span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ReferenceError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>另一种方式是编写一个工具来解决这个问题。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>IIFE和try/catch并不是完全等价的，因为如果将一段代码中的任意一部分拿出来用函数进行包裹，会改变这段代码的含义，其中的this、return、break和contine都会发生变化。IIFE并不是一个普适的解决方案，它只适合在某些情况下进行手动操作。</p></div><h2 id="第二部分-this和对象原型"><a href="#第二部分-this和对象原型" class="header-anchor">#</a> 第二部分 this和对象原型</h2> <h2 id="第一章-关于this"><a href="#第一章-关于this" class="header-anchor">#</a> 第一章 关于this</h2> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>this提供了一种更优雅的方式来隐式“传递”一个对象引用，因此可以将API设计得更加简洁并且易于使用。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>使用arguments.callee可以引用当前正在运行的函数对象。这是唯一一种可以从匿名函数对象内部引用自身的方法。但，更好的方式是避免使用匿名函数，至少在需要自引用时使用具名函数（表达式）。<strong>arguments.callee已经被弃用，不应该再使用它。</strong></p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>this在任何情况下都不指向函数的词法作用域。在JavaScript内部，作用域确实和对象类似，可见的标识符都是它的属性。但是作用域“对象”无法通过JavaScript代码访问，它存在于JavaScript引擎内部。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>当你想要把this和词法作用域的查找混合使用时，一定要提醒自己，这是无法实现的。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>this是在运行时绑定的，并不是在编写时绑定的，它的上下文取决于函数调用时的各种条件。this的绑定和函数声明的位置没有任何关系，只取决于函数的调用方式。</p> <p>当一个函数被调用时，会创建一个活动记录（有时候也称为执行上下文）。这个记录会包含函数在哪里被调用（调用栈）、函数的调用方式、传入的参数等信息。this就是这个记录的一个属性，会在函数执行的过程中用到。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>this既不指向函数自身也不指向函数的词法作用域</p></div><h2 id="第二章-this全面解析"><a href="#第二章-this全面解析" class="header-anchor">#</a> 第二章 this全面解析</h2> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>调用位置就是函数在代码找那个被调用的位置（而不是声明的位置）</p></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>什么是调用栈和调用位置</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当前调用栈是：baz</span>
  <span class="token comment">// 因此，当前调用位置是全局作用域</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'baz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;--- bar的调用位置</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当前调用栈是 baz -&gt; bar</span>
  <span class="token comment">// 因此，当前调用位置在baz中</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'bar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// &lt;--- foo的调用位置</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 当前调用栈是baz -&gt; bar -&gt; foo</span>
  <span class="token comment">// 因此，当前调用位置在bar中</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">baz</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;--- baz的调用位置</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></div><h3 id="绑定规则"><a href="#绑定规则" class="header-anchor">#</a> 绑定规则</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>默认绑定：函数独立调用</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>this.a被解析成了全局变量a。因为函数调用时应用了this的默认绑定，因此this指向全局对象。</p> <p>如果使用严格模式（strict mode），则不能将全局对象用于默认绑定，因此this会绑定到undefined；</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError: this is undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>this的绑定规则完全取决于调用位置，但是只有foo()运行在非strict mode下时，默认绑定才能绑定到全局对象；在严格模式下调用foo则不影响默认绑定</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

  <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>隐式绑定：调用位置是否有上下文对象，或者说是否被某个对象拥有或者包含。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  foo<span class="token punctuation">:</span> foo
<span class="token punctuation">}</span><span class="token punctuation">;</span>

obj<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>无论是直接在obj中定义还是先定义再添加为引用属性，这个函数严格来说都不属于obj对象。</p> <p>然而，调用位置会使用obj上下文来引用函数，因此你可以说函数被调用时obj对象“拥有”或者“包含”它。</p> <p>当函数引用有上下文对象时，隐式绑定规则会把函数调用中的this绑定到这个上下文对象。以你为调用foo()时this被绑定到obj，因此this.a和obj.a是一样的。</p> <p>对象属性引用链中只有上一层或者说最后一层在调用位置中起作用。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
  foo<span class="token punctuation">:</span> foo
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  obj2<span class="token punctuation">:</span> obj2
<span class="token punctuation">}</span><span class="token punctuation">;</span>

obj1<span class="token punctuation">.</span>obj2<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 42</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>隐式丢失</p> <p>最常见的this绑定问题就是被隐式绑定的函数会丢失绑定对象，也就是说它会应用默认绑定，从而把this绑定到全局对象或者undefined上，取决于是否是严格模式。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  foo<span class="token punctuation">:</span> foo
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> obj<span class="token punctuation">.</span>foo<span class="token punctuation">;</span> <span class="token comment">// 函数别名！</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;oops, global&quot;</span><span class="token punctuation">;</span> <span class="token comment">// a是全局对象的属性</span>

<span class="token function">bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;oops, global&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>虽然bar是obj.foo的一个引用，但是实际上，它引用的是foo函数本身，因此此时的bar()其实是一个不带任何修饰的函数调用，因此应用了默认绑定。</p> <p>参数传递其实就是一种隐式赋值，因此我们传入函数时也会被隐式赋值。所以，回调函数丢失this绑定是非常常见的。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">doFoo</span><span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// fn其实引用的是foo</span>

  <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &lt;-- 调用位置！</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  foo<span class="token punctuation">:</span> foo
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token string">&quot;oops, global&quot;</span><span class="token punctuation">;</span> <span class="token comment">// a是全局对象的属性</span>

<span class="token function">doFoo</span><span class="token punctuation">(</span>obj<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// &quot;oops, global&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>显式绑定：在某个对象上强制调用函数</p> <p>可以使用函数对象下的call和apply方法进行显式绑定。JavaScript提供的绝大多数函数以及你自己创建的所有函数都可以使用call()和apply()方法。它们的第一个参数是一个对象，是给this准备的，接着在调用函数时将其绑定到this。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>
<span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span>

<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>从this绑定的角度来说，call()和apply()是一样的，它们的区别体现在其他的函数上。</p> <p>ES5提供了内置的方法Function.prototype.bind，它的用法如下：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">,</span> something<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">+</span> something<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2 3</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 5</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>bind()会返回一个硬编码的新函数，它会把你指定的参数设置为this的上下文并调用原始函数。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>new 绑定</p> <p>构造函数只是一些使用new操作符时被调用的函数。他们并不会属于某个类，也不会实例化一个类。实际上，他们甚至都不能说是一种特殊的函数类型，它们只被new操作符调用的普通函数而已。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>something <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>使用new来调用函数，或者说发生构造函数调用时，会自动执行下面的操作。</p> <ol><li>创建（或者说构造）一个全新的对象</li> <li>这个新对象会被执行[[Prototype]]连接</li> <li>这个新对象会绑定到函数调用的this</li> <li>如果函数没有返回其他对象，那么new表达式中的函数调用会自动返回这个新对象。</li></ol> <p>使用new来调用foo()时，我们会构造一个新对象并把它绑定到foo()调用中的this上。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> a<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div><h3 id="绑定优先级"><a href="#绑定优先级" class="header-anchor">#</a> 绑定优先级</h3> <p>this的默认绑定优先级最低</p> <div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>显示绑定比隐式绑定的优先级高</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> something<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token punctuation">:</span> foo
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

obj1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>

obj1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">obj1<span class="token punctuation">.</span>foo</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>new 绑定比隐式绑定的优先级高</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> something<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  foo<span class="token punctuation">:</span> foo
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

obj1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>

obj1<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">obj1<span class="token punctuation">.</span>foo</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bar<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>new 绑定比显示绑定的优先级高，因为new创建了一个新的对象。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">something</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>a <span class="token operator">=</span> something<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span> <span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>

<span class="token keyword">var</span> baz <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">bar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>obj1<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>baz<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></div><h3 id="其他情况下的绑定"><a href="#其他情况下的绑定" class="header-anchor">#</a> 其他情况下的绑定</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>如果你把null或者undefined作为this的绑定对象传入call、apply、bind，这些值在调用时会被忽略，实际应用的是默认规则</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;a: &quot;</span> <span class="token operator">+</span> a <span class="token operator">+</span> <span class="token string">&quot;, b: &quot;</span> <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 把数组“展开”成参数</span>
foo<span class="token punctuation">.</span><span class="token function">aapply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  a:2, b:3</span>

<span class="token comment">// 使用bind(...)进行柯里化</span>
<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a:2, b:3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>更安全的this</p> <p>Object.create(null)和{}很像，但是并不会创建Object.prototype这个委托，所以它比{}更空。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;a: &quot;</span> <span class="token operator">+</span> a <span class="token operator">+</span> <span class="token string">&quot;, b:&quot;</span> <span class="token operator">+</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 我们的DMZ（非军事区，一个空的委托对象）对象</span>
<span class="token keyword">var</span> ø <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 把数组“展开”成参数</span>
foo<span class="token punctuation">.</span><span class="token function">aapply</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//  a:2, b:3</span>

<span class="token comment">// 使用bind(...)进行柯里化</span>
<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">bar</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a:2, b:3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>间接引用最容易在赋值时发生：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> foo<span class="token punctuation">:</span> foo<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token punctuation">{</span>a<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

o<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//3;</span>

<span class="token punctuation">(</span>p<span class="token punctuation">.</span>foo <span class="token operator">=</span> o<span class="token punctuation">.</span>foo<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>赋值表达式p.foo = o.foo的返回值是目标函数的引用，因此调用位置是foo()而不是p.foo()或者o.foo()。所以，这里会应用默认绑定。</p> <p>对于默认绑定来说，决定this绑定对象的并不是调用位置是否处于严格模式，而是函数体是否处于严格模式。如果函数体处于严格模式，this会被绑定到undefined，否则this会被绑定到全局对象。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>通过应用一种软绑定的方法可以防止函数应用默认绑定规则，也可以具有硬绑定没有的灵活性（使用硬绑定之后就无法使用隐式绑定或者显示绑定来修改this）。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>softBind<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">softBind</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> fn <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token comment">// 捕获所有 curried 参数</span>
    <span class="token keyword">var</span> curried <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> <span class="token function-variable function">bound</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span> <span class="token operator">||</span> <span class="token keyword">this</span> <span class="token operator">===</span> <span class="token punctuation">(</span>window <span class="token operator">||</span> global<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> obj <span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span>
        curried<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>curried<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    bound<span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>fn<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> bound<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>softBind会对指定的函数进行封装，手偶限检查调用时的this，如果this绑定到全局对象或者undefined，那就把指定的默认对象obj绑定大奥this，否则不会修改this。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;name: &quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;obj&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    obj2 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;obj2&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    obj3 <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">&quot;obj3&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> fooOBJ <span class="token operator">=</span> foo<span class="token punctuation">.</span><span class="token function">softBind</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fooOBJ</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name: obj</span>

obj2<span class="token punctuation">.</span>foo <span class="token operator">=</span> foo<span class="token punctuation">.</span><span class="token function">softBind</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
obj2<span class="token punctuation">.</span><span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name: obj2 &lt;---- 看！! ！</span>

<span class="token function">fooOBJ</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj3<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// name: obj3 &lt;---- 看！</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span>obj2<span class="token punctuation">.</span>foo<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// name: obj   &lt;---- 应用了软绑定</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>可以看到，软绑定版本的foo()可以手动将this绑定到obj2或者obj3上，但如果应用默认绑定，则会将this绑定到obj。</p></div><h3 id="this词法-箭头函数"><a href="#this词法-箭头函数" class="header-anchor">#</a> this词法：箭头函数</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>ES6中介绍了一种无法使用这些规则的特殊函数类型：箭头函数。</p> <p>箭头函数并不是使用function关键字定义，而是使用“=&gt;” 操作符定义。箭头函数不使用this的四种标准规则，而是根据外层（函数或者全局）作用域来决定this。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 返回一个箭头函数</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token parameter">a</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// this继承自foo函数</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> 
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj1 <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> obj2 <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> bar <span class="token operator">=</span> <span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj1<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token function">bar</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj2<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2，不是3！</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>箭头函数可以像bind()一样确保函数的this被绑定到指定对象，此外它的词法作用域取代了传统的this机制。在ES6之前我们就已经在使用一种和箭头函数类似的模式</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> self <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span> <span class="token comment">// lexical capture of this</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token function">foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div></div><h2 id="第三章-对象"><a href="#第三章-对象" class="header-anchor">#</a> 第三章 对象</h2> <div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>对象定义的语法</p> <p><strong>声明（文字）形式</strong></p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObj <span class="token operator">=</span> <span class="token punctuation">{</span>
  key<span class="token punctuation">:</span> <span class="token string">'value'</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>构造形式</strong></p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myObject<span class="token punctuation">.</span>key <span class="token operator">=</span> <span class="token string">'value'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在文字声明中你可以添加多个键/值对，但是在构造形式中你必须逐个添加属性。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>在JavaScript中一共有六种主要类型（语言类型）：</p> <ul><li>string</li> <li>number</li> <li>boolean</li> <li>null</li> <li>undefined</li> <li>object</li></ul> <p><strong>简单基本类型：string、boolean、number、null、undefined本身并不是对象。null有时会被当做一种对象类型，这其实是语言本身的一个bug。typeof null === 'object'</strong></p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>JavaScript中对象子类型（内置对象）：</p> <ul><li>String</li> <li>Number</li> <li>Boolean</li> <li>Object</li> <li>Function</li> <li>Array</li> <li>Date</li> <li>RegExp</li> <li>Error</li></ul> <p>在JavaScript中它们实际上只是一些内置函数。这些内置函数可以当做构造函数来使用，从而构造一个对应的子类型对象：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> strPrimitive <span class="token operator">=</span> <span class="token string">'I am a string'</span><span class="token punctuation">;</span>
<span class="token keyword">typeof</span> strPrimitive<span class="token punctuation">;</span> <span class="token comment">// string</span>
strPrimitive <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

<span class="token keyword">var</span> strObject <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token string">'I am a string'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">typeof</span> strObject<span class="token punctuation">;</span> <span class="token comment">// &quot;object&quot;</span>
strObject <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// 检查sub-type对象</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>strObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object String]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>原始值&quot;I am a string&quot;并不是一个对象，它只是一个字面量，并且是一个不可变的值。如果要执行一些获取长度、访问其中某个字符串等操作时需要将其转换为String对象。</p> <p>然而，JavaScript引擎会自动把字面量转换成String对象，所以可以在直接访问字面量下的属性和方法。</p> <p><strong>null和undefined没有对应的构造形式，它们只有文字形式。Date只有构造，没有文字形式。</strong></p> <p><strong>对于Object、Array、Function、RegExp来说，无论使用文字形式还是构造形式，它们都是对象，不是字面量。</strong></p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>对象值的存储是多种多样的，一般并不会存在对象容器内部。存在对象容器内部的是这些属性的名称，它们就像指针一样，指向这些值真正的存储位置。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">const</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span>

myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2; 属性访问</span>
myObject<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 2; 键访问</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>属性访问和键访问这两种语法的主要区别在于，<code>.</code>操作符要求属性名满足标识符的命名规范，而<code>['...']</code>语法可以接受任意UTF-8/Unicode字符串作为属性名。</p> <p>在对象中，属性名永远都是字符串。如果使用string（字面量）以外的其他值作为属性名，那么也会被转换为一个字符串。即时是数字也不例外。</p> <p>ES6增加了可计算属性名：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> prefix <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>prefix <span class="token operator">+</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token string">&quot;hello&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">[</span>prefix <span class="token operator">+</span> <span class="token string">&quot;baz&quot;</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token string">&quot;world&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">[</span><span class="token string">&quot;foobar&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// hello</span>
myObject<span class="token punctuation">[</span><span class="token string">&quot;foobaz&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// world</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></div><h3 id="属性描述符"><a href="#属性描述符" class="header-anchor">#</a> 属性描述符</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>从ES5开始，所有的属性都具备了属性描述符</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 这是创建一个普通属性是描述符使用的默认值</span>
Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  writable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 可写</span>
  enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 可枚举</span>
  configurable<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token comment">// 可配置</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>可以通过Object.defineProperty()来添加一个新属性或者修改一个已有属性，前提是<code>configurable</code>为true</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  writable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p><code>writable</code>决定是否可以修改属性的值。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  writable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不可写！</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在严格模式下，这种方法会报错：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  writable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不可写！</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span> <span class="token comment">// TypeError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p><code>configurable</code>表示只要是属性是可配置的，就可以使用<code>defineProperty()</code>方法来需修改属性描述符。<strong>不管是不是处理严格模式下，如果<code>configurable</code>为<code>false</code>后，再使用<code>definePrperty()</code>来修改属性描述符都将报错。</strong></p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 3</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
  configurable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 不可配置！</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 4</span>
myObject<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 5</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
  writable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TypeError</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>除了无法修改，<code>configurable: false</code>还会禁止删除这个属性</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2</span>

<span class="token keyword">delete</span> myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// undefined</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  writable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  configurable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2</span>
<span class="token keyword">delete</span> myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p><strong>不要把delete看作一个释放内存的工具，它只是一个删除对象属性的操作，仅此而已。</strong></p></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p><code>enumerable</code>描述符控制属性是否会出现在对象的属性枚举中，比如<code>for...in</code>循环。<code>enumerable: false</code>则不会出现在枚举中，反之<code>enumerate: true</code>则会出现在枚举中。用户定义的所有普通属性默认都是<code>enumerate: true</code>。</p></div><h3 id="对象属性的不变性"><a href="#对象属性的不变性" class="header-anchor">#</a> 对象属性的不变性</h3> <div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>所有方法创建的都是浅不变性，它们只会影响目标对象和它的直接属性。如果目标对象引用了其他对象（数组、对象、函数等），其他对象的内容不受影响，仍然是可变的。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>结合<code>writable: false</code>和<code>configurable: false</code>就可以创建一个真正的对象常量属性（不可修改、重定义或者删除）：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> <span class="token string">&quot;FAVORITE NUMBER&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  value<span class="token punctuation">:</span> <span class="token number">42</span><span class="token punctuation">,</span>
  writable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  configurable<span class="token punctuation">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>如果想禁止一个对象添加新属性并且保留已有属性，可以使用<code>Object.preventEtensions()</code>。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">preventExtensions</span><span class="token punctuation">(</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
myObject<span class="token punctuation">.</span>b<span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在严格模式下，将会抛出TypeError的错误。</p></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p><code>Object.seal()</code>会创建一个“密封”的对象，这个方法实际上会在一个现有对象上调用<code>Object.preventExtensions()</code>并把所有现有属性标记为<code>configuration: false</code>。</p> <p>所以，密封之后不仅不能添加新属性，也不能重新配置或者删除任何现有属性（虽然可以修改属性的值）。</p></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p><code>Object.freeze()</code>会创建一个冻结对象，这个方法实际上会在一个现有对象上调用<code>Object.seal()</code>并把所有“数据访问”属性标记为<code>writable:false</code>，这样就无法修改它们的值。</p> <p><strong>这个对象下其他对象的引用是不受影响的。如果想要“深度冻结”一个对象，可以通过遍历对象下的属性，调用Object.freeze()</strong></p></div><h3 id="get-和-put"><a href="#get-和-put" class="header-anchor">#</a> [[Get]]和[[Put]]</h3> <p><strong>对象默认的<code>[[Put]]</code>和<code>[[Get]]</code>操作分别可以设置属性值的设置和获取</strong></p> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>在语言规范中，<code>myObject.a</code>在<code>myObject</code>上实际上是实现了<code>[[Get]]</code>操作（有点像函数调用：<code>[[Get]]()</code>）。对象默认的内置<code>[[Get]]</code>操作首先在对象中查找是否有名称相同的属性，如果找到就返回这个属性的值。</p> <p>如果没有找到名称相同的属性，按照<code>[[Get]]</code>算法的定义会遍历可能存在的<code>[[Prototype]]</code>链，也就是原型链。</p> <p>无论如何都没有找到名称相同的属性，那么<code>[[Get]]</code>操作会返回值<code>undefined</code></p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>b<span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>下面代码中这两个引用没有区别——它们都返回了<code>undefined</code>，实际上底层的<code>[[Get]]</code>操作对<code>myObject.b</code>进行了原型链查找：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token keyword">undefined</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// undefined</span>

myObject<span class="token punctuation">.</span>b<span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p><code>[[Put]]</code>被触发时，实际的行为取决于许多因素，包括对象中是否已经存在这个属性（这是最重要的因素）。</p> <p>如果存在这个属性，<code>[[Put]]</code>算法大致会检查下面这些内容：</p> <ul><li>属性是否是访问描述符？如果是并且存在<code>setter</code>就调用<code>setter</code></li> <li>属性的数据描述符中<code>writable</code>是否为<code>false</code>？如果是，在非严格模式下失败，在严格模式下抛出<code>TypeError</code>异常。</li> <li>如果都不是，将该值设置为属性的值</li></ul></div><h3 id="getter和setter"><a href="#getter和setter" class="header-anchor">#</a> Getter和Setter</h3> <div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>在ES5中可以使用<code>getter</code>和<code>setter</code>部分改写默认操作，但是只能应用在单个属性上，无法应用在整个对象上。<code>getter</code>是一个隐藏函数，会在获取属性值时调用。 <code>setter</code> 也是一个隐藏函数，会在设置属性值时调用。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>对于访问描述符来说，JavaScript会忽略它们的 <code>value</code> 和 <code>writable</code> 特性，取而代之的是关心 <code>set</code> 和 <code>get</code> （还有 <code>configurable</code> 和 <code>enumerable</code> ）特性。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 给a定义一个getter</span>
  <span class="token keyword">get</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>
  myObject<span class="token punctuation">,</span>  <span class="token comment">// 目标对象</span>
  <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span>         <span class="token comment">// 属性名</span>
  <span class="token punctuation">{</span>           <span class="token comment">// 描述符</span>
    <span class="token comment">// 给b设置一个getter</span>
    <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>a ＊ <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 确保b会出现在对象的属性列表中</span>
    enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2</span>

myObject<span class="token punctuation">.</span>b<span class="token punctuation">;</span> <span class="token comment">// 4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>不管是对象文字语法中的<code>get a() {}</code>,还是<code>defineProperty()</code>中的显示定义，二者都会在对象中创建一个不包含值的属性，对于这个属性的访问会自动调用一个隐藏函数，它的返回值会被当做属性访问的返回值：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 给a定义一个getter</span>
  <span class="token keyword">get</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>setter会覆盖单个属性默认的[[Put]]（也被成为赋值）操作。通常来说getter和setter是成对出现的。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 给a定义一个getter</span>
  <span class="token keyword">get</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span> a <span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token comment">// 给a定义一个setter</span>
  <span class="token keyword">set</span> <span class="token function">a</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span> a  <span class="token operator">=</span> val ＊ <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></div><h3 id="检查属性是否存在于对象中"><a href="#检查属性是否存在于对象中" class="header-anchor">#</a> 检查属性是否存在于对象中</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>在不访问属性值的情况下判断对象中是否存在这个属性：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token keyword">in</span> myObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span> <span class="token keyword">in</span> myObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

myObject<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
myObject<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><code>in</code>操作符会检查属性是否存在于<code>myObject</code>对象中及其<code>[[Prototype]]</code>原型链中。<code>hasOwnProperty()</code>只会检查属性是否存在于<code>myObject</code>对象中，不会检查<code>[[Prototype]]</code>原型链。</p> <p>普通对象可以通过<code>Object.prototype</code>的委托来访问<code>hasOwnProperty()</code>。</p> <p>通过<code>Object.create(null)</code>来创建的对象没有连接到<code>Object.prototype</code>上（比如这个对象叫<code>myObject</code>），这种情况下，<code>myObject.hasOwnProperty()</code>就会失败。这时可以使用<code>Object.prototype.hasOwnProperty.call(myObject, 'a')</code>来进行判断。它借用基础的<code>hasOwnProperty()</code>方法并把它显式绑定到<code>myObject上</code>。</p></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>看起来<code>in</code>操作符可以检查容器内是否有某个值，但是它实际上检查的是某个属性是否存在。对于数组来说这个区别非常重要，<code>4 in [2, 4, 6]</code>的结果并不是<code>true</code>。这是因为<code>[2,4,6]</code>这个数组中包含的属性名是<code>0、1、2</code>。</p></div><h3 id="enumerable枚举"><a href="#enumerable枚举" class="header-anchor">#</a> enumerable枚举</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>
  myObject<span class="token punctuation">,</span>
  <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 让a像普通属性一样可以枚举</span>
  <span class="token punctuation">{</span> enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>
  myObject<span class="token punctuation">,</span>
  <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 让b不可枚举</span>
  <span class="token punctuation">{</span> enumerable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>b<span class="token punctuation">;</span> <span class="token comment">// 3</span>
<span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span> <span class="token keyword">in</span> myObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
myObject<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token comment">// .......</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> k <span class="token keyword">in</span> myObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> myObject<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// &quot;a&quot; 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>在代码中，<code>myObject.b</code>确实存在并且有访问值，但是却不会出现在<code>for...in</code>循环中（尽管可以通过<code>in</code>操作符来判读是否存在）。原因是，“可枚举”就相当于“可以出现在对象属性的遍历中”。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>另一种方式来区分属性是否可枚举</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>
  myObject<span class="token punctuation">,</span>
  <span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 让a像普通属性一样可以枚举</span>
  <span class="token punctuation">{</span> enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">2</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>
  myObject<span class="token punctuation">,</span>
  <span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 让b不可枚举</span>
  <span class="token punctuation">{</span> enumerable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span><span class="token function">propertyIsEnumerable</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
myObject<span class="token punctuation">.</span><span class="token function">propertyIsEnumerable</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;a&quot;]</span>
Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyNames</span><span class="token punctuation">(</span>myObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;a&quot;, &quot;b&quot;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><code>propertyIsEnumerable()</code>会检查给定的属性名是否直接存在于对象中（而不是在原型链上）并且满足<code>enumerable: true</code>的条件。</p> <p><code>Object.keys()</code>会返回一个数组，包含所有可枚举属性，<code>Object.getOwnPropertyNames()</code>会返回一个数组，包含所有属性，无论它们是否可枚举。</p> <p><code>Object.keys()</code>和<code>Object.getOwnPropertyNames()</code>都只会查找对象直接包含的属性。</p></div><h3 id="对象的遍历"><a href="#对象的遍历" class="header-anchor">#</a> 对象的遍历</h3> <div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p><code>for...in</code>循环可以用来遍历对象的可枚举属性列表，包括<code>[[Prototype]]</code>链</p></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>遍历数组下标时采用的是数字顺序（<code>for</code>循环或者其他迭代器），但是遍历对象属性时的顺序是不确定的，在不同的JavaScript引擎中可能不一样。因此，在不同的环境中徐亚保证一致性时，一定不要相信任何观察到的顺序，它们是不可靠的。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>ES6增加了一种用来遍历数组的<code>for...of</code>循环语法，如果对象本身定义了迭代器的话也可以遍历对象：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> v <span class="token keyword">of</span> myArray<span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 1</span>
<span class="token comment">// 2</span>
<span class="token comment">// 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>数组有内置的<code>@@iterator</code>，因此<code>for...of</code>可以直接应用在数组上。使用内置的<code>@@iterator</code>来手动遍历数组：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> it <span class="token operator">=</span> myArray<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: 1, done: false }</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: 2, done: false }</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { value: 3, done: false }</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// { done: true }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>和值“3”一起返回的是<code>done: false</code>，需要再调用一次<code>next()</code>才能得到<code>done: true</code>，从而完成遍历。这是因为和ES6中发生器函数的语义相关。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>普通的对象没有内置的<code>@@iterator</code>，所以无法自动完成<code>for...of</code>遍历。这样做是为了避免影响未来的对象类型。</p> <p>我们可以给想要遍历的对象定义<code>@@iterator</code></p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  b<span class="token punctuation">:</span> <span class="token number">3</span>
<span class="token punctuation">}</span>

Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>myObject<span class="token punctuation">,</span> Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  enumerable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  writable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  configurable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token function-variable function">value</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> ks <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">next</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          value<span class="token punctuation">:</span> o<span class="token punctuation">[</span>ks<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          done<span class="token punctuation">:</span> idx <span class="token operator">&gt;</span> ks<span class="token punctuation">.</span>length<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 手动遍历myObject</span>
<span class="token keyword">var</span> it <span class="token operator">=</span> myObject<span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 2, done: false }</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { value: 3, done: false }</span>
it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// { done: true }</span>

<span class="token comment">// 用for...of遍历myObject</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> v <span class="token keyword">of</span> myObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// 2</span>
<span class="token comment">// 3</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>使用<code>Object.defineProperty()</code>定义了<code>myObject</code>对象自己的<code>@@iterator</code>主要是为了让<code>@@iterator</code>不可枚举。此外，也可以直接定义对象时进行声明，比如<code>var myObject = {a: 2, b: 3, [Symbol.iterator]: function() {...}}</code></p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>定义一个永远不会结束的迭代器</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> randoms <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>Symbol<span class="token punctuation">.</span>iterator<span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">next</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span> value<span class="token punctuation">:</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> randoms_pool <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> n <span class="token keyword">of</span> randoms<span class="token punctuation">)</span><span class="token punctuation">{</span>
  randooms_pool<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 防止无限运行，导致程序挂起</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>randoms_pool<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></div><h2 id="第五章-原型"><a href="#第五章-原型" class="header-anchor">#</a> 第五章 原型</h2> <h3 id="prototype"><a href="#prototype" class="header-anchor">#</a> [[Prototype]]</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>对于默认的<code>[[Get]]</code>操作来说，如果无法在对象本身找到需要的属性，就会继承访问对象的<code>[[Prototype]]</code>链</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> anotherObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 创建一个关联到anotherObject的对象</span>
<span class="token keyword">var</span> myObject <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>anotherObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>Object.create()</code>会创建一个对象并把这个对象的<code>[[Prototype]]</code>关联到指定的对象。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>使用<code>for...in</code>遍历对象时原理和查找<code>[[Prototype]]</code>链类似，任何可以通过原型链访问到并且是<code>enumerable</code>的属性都会被枚举。使用<code>in</code>操作符来检查属性在对象中是否存在时，同样会查找对象的整条原型链，无论属性是否可以枚举</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> anotherObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 创建一个关联到anotherObject的对象</span>
<span class="token keyword">var</span> myObject <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>anotherObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> k <span class="token keyword">in</span> myObject<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;found: &quot;</span> <span class="token operator">+</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// found: a</span>

<span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span> <span class="token keyword">in</span> myObject<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>当你通过各种语法进行属性查找时都会查找<code>[[Prototype]]</code>链，知道找到属性或者查找完整条原型链。</p></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>所有普通的<code>[[Prototype]]</code>链最终都会指向内置的<code>Object.prototype</code>。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>myObject<span class="token punctuation">.</span>foo <span class="token operator">=</span> <span class="token string">'bar'</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果<code>myObject</code>对象中包含名为<code>foo</code>的普通数据访问属性，这条赋值语句只会修改已有的属性值。</p> <p>如果<code>foo</code>不是直接存在于<code>myObject</code>中，<code>[[Prototype]]</code>链就会被遍历，类似<code>[[Get]]</code>操作。如果原型链上找不到<code>foo</code>，<code>foo</code>会被直接添加到<code>myObject</code>上。</p> <p>如果属性名即出现在<code>myObject</code>中也出现在<code>myObject</code>的<code>[[Prototype]]</code>链上，那么就会发生屏蔽。<code>myObject</code>中包含的<code>foo</code>属性会屏蔽原型链上的所有<code>foo</code>属性，因为<code>myObject.foo</code>总是会选择原型链中最底层的<code>foo</code>属性。</p> <p>如果<code>foo</code>存在于原型链上，赋值语句<code>myObject.foo = 'bar'</code>的行为会有以下逻辑：</p> <ol><li>如果在<code>[[Prototype]]</code>链上存在<code>foo的</code>普通数据访问属性并且没有被标记为只读（<code>writable: false</code>），会直接在<code>myObject</code>中添加一个名为<code>foo</code>的新属性，它是屏蔽属性。</li> <li>如果在<code>[[Prototype]]</code>链上存在<code>foo</code>，但是它被标记为只读（<code>writable: false</code>），那么无法修改已有属性或者在<code>myObject上</code>创建屏蔽属性。如果运行在严格模式下，代码会抛出一个错误。否则，这条赋值语句会被忽略。总之，不会发生屏蔽。</li> <li>如果在<code>[[Prototype]]</code>链上存在<code>foo</code>并且它是一个<code>setter</code>，那就一定会调用这个<code>setter</code>。<code>foo</code>不会被添加到<code>myObject上</code>，也不会重新定义<code>foo</code>这个<code>setter</code>。</li></ol> <p>如果希望在第二种和第三种情况下也屏蔽原型链上的<code>foo</code>，那就不能使用<code>=</code>操作符来赋值，而是使用<code>Object.defineProperty()</code>来向<code>myObject</code>添加<code>foo</code>。</p> <p>第二种情况中的只读属性会阻止<code>[[Prototype]]</code>链下层的<code>myObject</code>创建（屏蔽）同名属性。这样做主要是为了模拟类属性的继承。把原型链上层的<code>foo</code>看作是父类中的属性，它会被<code>myObject</code>继承，这样<code>myObject</code>中的<code>foo</code>属性也是只读，所以无法创建。但实际上并不会发生类似的继承复制。这个限制只存在于<code>=</code>赋值中，使用<code>Object.defineProperty()</code>并不会受影响。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>有些情况会隐式产生屏蔽：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> anotherObject <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> myObject <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>anotherObject<span class="token punctuation">)</span><span class="token punctuation">;</span>

anotherObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2</span>
myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2</span>

anotherObject<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
myObject<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>

myObject<span class="token punctuation">.</span>a<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 隐式屏蔽！</span>

anotherObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2</span>
myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 3</span>

myObject<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>修改委托属性时一定要小心。如果想要让anotherObject.a的值增加，唯一的办法是anotherObject.a++。</p></div><h3 id="类"><a href="#类" class="header-anchor">#</a> &quot;类&quot;</h3> <div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>在JavaScript中只有对象，没有类的定义，因为对象可以直接定义自己的行为。</p></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>所有的函数默认都会拥有一个名为<code>prototype</code>的公有并且不可枚举的属性，它会指向另一个对象</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">// {}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>这个对象通常被称为<code>Foo</code>的原型，因为我们通过名为<code>Foo.prototype</code>的属性引用来访问它。</p> <p>这个对象是在调用<code>new Foo()</code>时创建的，最后欧会被关联到这个<code>Foo.prototype</code>对象上。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>调用<code>new Foo()</code>时会创建a，其中一步就是将<code>a</code>内部的<code>[[Prototype]]</code>链接到<code>Foo.prototype</code>所指的对象。</p></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>在JavaScript中，并没有类似的复制机制。不能创建一个类的多个实例，只能创建多个对象，它们<code>[[Prototype]]</code>关联的是同一个对象。但是在默认情况下并不会进行复制，因此这些对象之间并不会完全失去联系，它们是互相关联的。</p></div><div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>JavaScript会在两个对象之间创建一个关联，这样一个对象就可以通过委托访问另一个对象的属性和函数。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Foo<span class="token punctuation">;</span> <span class="token comment">// true</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Foo<span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><code>Foo.prototype</code>默认有一个公有并且不可枚举的属性<code>.constructor</code>，这个属性引用的是对象关联的函数（本例中是<code>Foo</code>）。此外，我们可以看到通过”构造函数“调用<code>new Foo()</code>创建的对象也有一个<code>.constructor</code>属性，指向”创建这个对象的函数“。</p> <p><strong>实际上<code>a</code>本身并没有<code>.constructor</code>属性。而且，虽然<code>a.constructor</code>确实指向<code>Foo</code>函数，但是这个属性并不是表示<code>a</code>由<code>Foo</code>构造</strong></p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>Foo和你程序中的其他函数没有任何区别。函数本身并不是构造函数，然而，当你在普通的函数调用前面加上new关键字之后，就会把这个函数调用变成一个”构造函数调用“。实际上，new会劫持所有普通函数并用构造对象的形式来调用它。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">NothingSpecial</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Don't mind me! &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NothingSpecial</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// &quot;Don't mind me! &quot;</span>

a<span class="token punctuation">;</span> <span class="token comment">// {}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在JavaScript中对于”构造函数“最准确的解释是，所有带new的函数调用。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token regex">/＊ .. ＊/</span> <span class="token punctuation">}</span>

<span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token regex">/＊ .. ＊/</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 创建一个新原型对象</span>

<span class="token keyword">var</span> a1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a1<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Foo<span class="token punctuation">;</span> <span class="token comment">// false!</span>
a1<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Object<span class="token punctuation">;</span> <span class="token comment">// true!</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><code>a1</code>并没有<code>.constructor</code>属性，所以它会委托<code>[[Prototype]]</code>链上的<code>Foo.prototype</code>。但是<code>Foo.prototype</code>这个对象也没有<code>.constructor</code>属性，所以它会继续委托，直到委托给链顶端的<code>Object.prototype</code>。<code>Object.prototype</code>对象有<code>.constructor</code>属性，指向内置的<code>Object()</code>函数。</p></div><h3 id="原型-继承"><a href="#原型-继承" class="header-anchor">#</a> （原型）继承</h3> <div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myName</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Bar</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> label</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Foo</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>label <span class="token operator">=</span> label<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 创建一个新的Bar.prototype对象并关联到Foo.prototype</span>
<span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 注意！现在没有Bar.prototype.constructor了</span>
<span class="token comment">// 如果你需要这个属性的话可能需要手动修复一下它</span>

<span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">myLabel</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>label<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span> <span class="token string">'obj a'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
a<span class="token punctuation">.</span><span class="token function">myName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// a</span>
a<span class="token punctuation">.</span><span class="token function">myLable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// obj a</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>这段代码的核心部分是语句<code>Bar.prototype = Object.create(Foo.prototype)</code>。调用<code>Object.create()</code>会创建一个”新“对象并把新对象内部的<code>[[Prototype]]</code>关联到你指定的对象（本例中是<code>Foo.prototype</code>）。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// 和你想要的机制不一样！</span>
<span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>

<span class="token comment">// 基本上满足你的新需求，但是可能会产生一些副作用:(</span>
<span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><code>Bar.prototype = Foo.prototype</code>并不会创建一个关联到<code>Bar.prototype</code>的新对象，它只是让<code>Bar.prototype</code>直接引用了<code>Foo.prototype</code>对象。因此当你执行类似<code>Bar.prototype.myLable = ...</code>的赋值语句时会直接修改<code>Foo.prototype</code>对象本身。</p> <p><code>Bar.prototype = new Foo()</code>的确会创建一个关联到<code>Bar.prototype</code>的新对象。但是它使用了<code>Foo()</code>的&quot;构造函数调用&quot;，如果函数<code>Foo</code>有一些副作用（比如写日志、修改状态、注册到其他对象等等）的话，就会影响到<code>Bar()</code>的”后代“，后果不堪设想。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>ES6添加了辅助函数Object.setPrototypeOf()，可以用标准并且可靠的方法来修改关联。</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token comment">// ES6之前需要抛弃默认的Bar.prototype</span>
<span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>

<span class="token comment">// ES6开始可以直接需修改现有的Bar.prototype</span>
Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span><span class="token class-name">Bar</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> Foo<span class="token punctuation">.</span>prtotype<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>blah <span class="token operator">=</span> <span class="token operator">...</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>通过 <code>instanceof</code> 找出a的祖先（委托关联）</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>a <span class="token keyword">instanceof</span> <span class="token class-name">Foo</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>通过isPrototypeOf()方法来判断</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">isPrototypeOf</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>直接或缺一个对象的[[Prototype]]链，用于判断</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>部分浏览器也支持一种非标准的方法来访问内部[[Prototype]]属性</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>a<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Foo</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><code>.__proto__</code>看起来很像一个属性，但实际上它更像一个<code>getter/setter</code>。<code>.__proto__</code>的实现大致上是这样的</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token string">&quot; __proto__&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Object<span class="token punctuation">.</span><span class="token function">getPrototypeOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ES6中的setPrototypeOf(..)</span>
    Object<span class="token punctuation">.</span><span class="token function">setPrototypeOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> o<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> o<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></div><h3 id="对象关联"><a href="#对象关联" class="header-anchor">#</a> 对象关联</h3> <div class="note-block"><svg t="1665301607231" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4678" width="200" height="200" class="icon" style="width:20px;height:20px;"><path d="M512 469.333333m-426.666667 0a426.666667 426.666667 0 1 0 853.333334 0 426.666667 426.666667 0 1 0-853.333334 0Z" fill="#FFF59D" p-id="4679"></path><path d="M789.333333 469.333333c0-164.266667-140.8-294.4-309.333333-275.2-128 14.933333-230.4 117.333333-243.2 245.333334-10.666667 98.133333 29.866667 185.6 98.133333 241.066666 29.866667 25.6 49.066667 61.866667 49.066667 102.4v6.4h256v-2.133333c0-38.4 17.066667-76.8 46.933333-102.4 61.866667-51.2 102.4-128 102.4-215.466667z" fill="#FBC02D" p-id="4680"></path><path d="M652.8 430.933333l-64-42.666666c-6.4-4.266667-17.066667-4.266667-23.466667 0L512 422.4l-51.2-34.133333c-6.4-4.266667-17.066667-4.266667-23.466667 0l-64 42.666666c-4.266667 4.266667-8.533333 8.533333-8.533333 14.933334s0 12.8 4.266667 17.066666l81.066666 100.266667V789.333333h42.666667V554.666667c0-4.266667-2.133333-8.533333-4.266667-12.8l-70.4-87.466667 32-21.333333 51.2 34.133333c6.4 4.266667 17.066667 4.266667 23.466667 0l51.2-34.133333 32 21.333333-70.4 87.466667c-2.133333 4.266667-4.266667 8.533333-4.266667 12.8v234.666666h42.666667V563.2l81.066667-100.266667c4.266667-4.266667 6.4-10.666667 4.266666-17.066666s-4.266667-12.8-8.533333-14.933334z" fill="#FFF59D" p-id="4681"></path><path d="M512 938.666667m-64 0a64 64 0 1 0 128 0 64 64 0 1 0-128 0Z" fill="#5C6BC0" p-id="4682"></path><path d="M554.666667 960h-85.333334c-46.933333 0-85.333333-38.4-85.333333-85.333333v-106.666667h256v106.666667c0 46.933333-38.4 85.333333-85.333333 85.333333z" fill="#9FA8DA" p-id="4683"></path><path d="M640 874.666667l-247.466667 34.133333c6.4 14.933333 19.2 29.866667 34.133334 38.4l200.533333-27.733333c8.533333-12.8 12.8-27.733333 12.8-44.8zM384 825.6v42.666667L640 832v-42.666667z" fill="#5C6BC0" p-id="4684"></path></svg> <style>
          blockquote {
            background-color: var(--code-color);
            border-color: #67cc86;
            border-left-width: 0.5rem;
            border-left-style: solid;
          }
        </style><p>Object.create(null)会创建一个拥有空（或者说null）[[Prototype]]链接的对象，这个对象无法进行委托。由于这个对象没有原型链，所以instanceof操作符无法进行判断，因此总是会返回false。这些特殊的空[[Prototype]]对象通常被称作”字典“，他们完全不会受到原型链的干扰，因此非常适合用来存储数据。</p></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>ES5之前实现Object.create方法：</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> Object<span class="token punctuation">.</span>create<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  Object<span class="token punctuation">.</span><span class="token function-variable function">create</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></div><div class="note-block"><svg t="1665486468429" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16415" width="200" height="200" class="icon" style="width:20px;height:20px;fill:var(--text-color);"><path d="M944.981319 147.815557l0 413.93759c0 7.367805-3.949962 14.152325-10.345626 17.795295-3.755534 2.13871-93.335758 52.352345-208.80563 52.352345-111.100354 0-181.892677-20.537755-244.355287-38.660508-51.001581-14.797008-95.054913-27.578102-153.035442-27.578102-20.701484 0-40.97318 0.818645-60.262502 2.425236-11.266601 0.941442-21.151739-7.429203-22.093181-18.695804-0.931209-11.266601 7.429203-21.151739 18.695804-22.093181 20.414959-1.698688 41.832757-2.568499 63.659879-2.568499 63.803141 0 112.686479 14.183024 164.445306 29.194926 62.759369 18.21485 127.657448 37.043684 232.945423 37.043684 83.276658 0 152.800082-29.40982 178.219008-41.699728l0-368.963283c-37.83163 16.260335-102.095259 37.647435-178.219008 37.647435-86.663802 0-147.908678-26.125007-207.127408-51.380204-57.827033-24.661679-112.440885-47.962362-190.263321-47.962362-77.218686 0-123.420961 7.592932-148.573827 13.96813-14.612813 3.704368-24.02723 7.429203-29.645181 10.120498l0 750.216473c0 11.2973-9.168824 20.466124-20.466124 20.466124-11.307533 0-20.466124-9.168824-20.466124-20.466124l0-761.657037c0-5.577019 2.27174-10.908444 6.293333-14.766308 6.764054-6.487761 48.770773-38.814004 212.857922-38.814004 86.193081 0 147.263995 26.053376 206.318996 51.247174 57.990762 24.733311 112.768343 48.095391 191.071733 48.095391 94.348831 0 168.477133-36.132942 188.95349-47.205115 6.334265-3.428076 14.019295-3.27458 20.210297 0.419556C941.195086 133.929292 944.981319 140.601248 944.981319 147.815557z" p-id="16416"></path></svg> <style>
        blockquote {
          background-color: var(--code-color);
          border-color: #67cc86;
          border-left-width: 0.5rem;
          border-left-style: solid;
        }
      </style><p>Object.create()的第二个参数指定了需要添加到新对象中的属性名以及这些属性的属性描述符</p> <div class="language-JavaScript line-numbers-mode"><pre class="language-javascript"><code><span class="token keyword">var</span> anotherObject <span class="token operator">=</span> <span class="token punctuation">{</span>
    a<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> myObject <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>anotherObject<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    b<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      enumerable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      writable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      configurable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token number">3</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    c<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      enumerable<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      writable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      configurable<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      value<span class="token punctuation">:</span> <span class="token number">4</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

myObject<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// false</span>
myObject<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>
myObject<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// true</span>

myObject<span class="token punctuation">.</span>a<span class="token punctuation">;</span> <span class="token comment">// 2</span>
myObject<span class="token punctuation">.</span>b<span class="token punctuation">;</span> <span class="token comment">// 3</span>
myObject<span class="token punctuation">.</span>c<span class="token punctuation">;</span> <span class="token comment">// 4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></div></div></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.730fe383.js" defer></script><script src="/assets/js/3.9989142c.js" defer></script><script src="/assets/js/1.3a008db8.js" defer></script><script src="/assets/js/42.a5250d52.js" defer></script>
  </body>
</html>
